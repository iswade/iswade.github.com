
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://iswade.github.io/go/go_tools/">
      
      <link rel="icon" href="../../themes/me.svg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Go 语言工具 - iswade's blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../themes/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#go" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="iswade&#39;s blog" class="md-header__button md-logo" aria-label="iswade's blog" data-md-component="logo">
      
  <img src="../../themes/me.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            iswade's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Go 语言工具
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="iswade&#39;s blog" class="md-nav__button md-logo" aria-label="iswade's blog" data-md-component="logo">
      
  <img src="../../themes/me.svg" alt="logo">

    </a>
    iswade's blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        主页
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          数据库
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="数据库" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/adb_nodes/00_index/" class="md-nav__link">
        高级数据库笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/buffer/buffer_details/" class="md-nav__link">
        PostgreSQL缓存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/crdb/crdb_paper_cn/" class="md-nav__link">
        CockroachDB翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/crdb/crdb_paper/" class="md-nav__link">
        CockroachDB论文
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/taurus_paper_cn/" class="md-nav__link">
        TaurusDB翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/taurus_paper/" class="md-nav__link">
        TaurusDB论文
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/pebble/" class="md-nav__link">
        PebbleKV存储引擎
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/faunadb_transaction/" class="md-nav__link">
        FaunaDB分布式事务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/Aurora_design_cloud_native_database/" class="md-nav__link">
        Aurora数据库
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/btree_vs_lsmtree/" class="md-nav__link">
        BTREEvsLSMTree
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/db_nodes/00_database_systems_2018/" class="md-nav__link">
        数据库笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/F1_query/" class="md-nav__link">
        F1 Query
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          分布式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="分布式" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          分布式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/distsys/" class="md-nav__link">
        分布式系统大纲
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/partition/" class="md-nav__link">
        数据分区
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/strong_consistency_models/" class="md-nav__link">
        强一致性模型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/zookeeper/" class="md-nav__link">
        Zookeeper翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/paxos_made_live/" class="md-nav__link">
        PaxosMadeLive翻译
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          编程语言
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="编程语言" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          编程语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/go_concurrency/" class="md-nav__link">
        Go并发编程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/go_interface/" class="md-nav__link">
        如何使用Go接口
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          软件工程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="软件工程" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          软件工程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/pragmatic_programmer/" class="md-nav__link">
        程序员修炼之道
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/bash_turorial/" class="md-nav__link">
        bash教程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../translate/linux_sysadmin/" class="md-nav__link">
        linux系统管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/git/" class="md-nav__link">
        git入门教程
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#go_1" class="md-nav__link">
    go
  </a>
  
    <nav class="md-nav" aria-label="go">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-build" class="md-nav__link">
    go build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-run" class="md-nav__link">
    go run
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-get" class="md-nav__link">
    go get
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-test" class="md-nav__link">
    go test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-tool" class="md-nav__link">
    go tool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problems" class="md-nav__link">
    problems
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="go">Go 语言工具</h1>
<p>有一套程序来构建和处理Go源代码。套件中的程序通常由 go 程序调用，而不是直接运行。</p>
<p>运行这些程序的最常见方法是作为 go 程序的子命令，例如 go fmt。像这样运行，该命令对Go源代码的完整包进行操作，go 程序使用包级参数调用基础二进制文件。</p>
<p>这些程序也可以作为独立的二进制文件运行，使用 go 工具子命令（如 go 工具 cgo）使用未修改的参数。对于大多数命令，这主要对调试有用。某些命令，如 pprof，只能通过 go tool 子命令访问。</p>
<p>最后，fmt 和 godoc 命令被安装为普通的二进制文件，称为 gofmt 和 godoc，因为它们的引用次数很多。</p>
<p>单击链接以获取更多文档、调用方法和用法详细信息。</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Synopsis</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://golang.org/cmd/go/">go</a></td>
<td>go 程序操作 go 源码，运行其它工具程序。</td>
</tr>
<tr>
<td>tool <a href="https://golang.org/cmd/cgo/">cgo</a></td>
<td>cgo 用于支持 Go 包调用 C 代码。</td>
</tr>
<tr>
<td>tool <a href="https://golang.org/cmd/cover/">cover</a></td>
<td>cover 是一个程序，用于创建和分析覆盖率分析信息，由 <code>"go test -coverprofile"</code> 生成。</td>
</tr>
<tr>
<td>tool <a href="https://golang.org/cmd/fix/">fix</a></td>
<td>fix 程序找到使用语言和库的旧功能的 Go 程序，并以较新的 Go 语言重写。</td>
</tr>
<tr>
<td><a href="https://golang.org/cmd/gofmt/">fmt</a></td>
<td>fmt 格式化 go 包，它也可以作为一个独立的 gofmt 命令与更多的通用选项。</td>
</tr>
<tr>
<td>tool <a href="https://godoc.org/golang.org/x/tools/cmd/godoc/">doc</a></td>
<td>godoc 为 Go 包提取并生成文档。</td>
</tr>
<tr>
<td>tool <a href="https://golang.org/cmd/vet/">vet</a></td>
<td>vet 检查 Go 源代码并报告可疑的构造，如参数与格式字符串不匹配的Printf调用。</td>
</tr>
<tr>
<td>tool asm</td>
<td>asm（通常被调用为 go tool asm）将源文件（汇编代码文件）组装到一个对象文件中，该对象文件以参数源文件的基名命名，后缀为.o。然后，可以将对象文件与其他对象组合到包归档文件中。</td>
</tr>
<tr>
<td>tool compile</td>
<td>compile（通常作为“go tool compile”调用）编译多个文件组成的Go包。然后，写入一个对象文件，以第一个源码文件名的对象文件（ .o）。然后，可以将对象文件与其他对象组合到包归档文件中，或者直接传递到链接器（“go tool link”）。如果使用-pack调用，编译器将跳过中间对象文件，直接写入归档文件。生成的文件包含包导出的符号的类型信息，以及包从其他包导入的符号使用的类型信息。因此，在编译P包的客户端C时，不必读取P的依赖项文件，只需读取P的编译输出。</td>
</tr>
<tr>
<td>tool link</td>
<td>link（通常作为“go tool link”调用）读取包主目录的Go归档文件或对象及其依赖项，并将其组合到可执行二进制文件中。</td>
</tr>
<tr>
<td>tool pack</td>
<td>pack 是传统 Unix ar 工具的简单版本。</td>
</tr>
<tr>
<td>tool pprof</td>
<td>pprof 解释和显示 Go 程序的概要文件。</td>
</tr>
<tr>
<td>tool test2json</td>
<td>Test2json 将 go test 输出转换为机器可读的JSON流。</td>
</tr>
<tr>
<td>tool trace</td>
<td>trace 是查看跟踪文件的工具。</td>
</tr>
</tbody>
</table>
<p>这是一份简略的清单。有关编译器等的文档，请参阅 <a href="https://golang.org/cmd/">完整命令参考</a>。</p>
<h2 id="go_1">go</h2>
<div class="highlight"><pre><span></span><code>bug         start a bug report
build       compile packages and dependencies
clean       remove object files and cached files
doc         show documentation for package or symbol
env         print Go environment information
fix         update packages to use new APIs
fmt         gofmt (reformat) package sources
generate    generate Go files by processing source
get         add dependencies to current module and install them
install     compile and install packages and dependencies
list        list packages or modules
mod         module maintenance
run         compile and run Go program
test        test packages
tool        run specified go tool
version     print Go version
vet         report likely mistakes in packages
</code></pre></div>

<h3 id="go-build">go build</h3>
<ol>
<li>
<p>-x 列出 build 过程中用到的所有工具，mkdir/gcc等等</p>
</li>
<li>
<p>-n 不实际编译，仅打印出 build  过程中用到的所有工具</p>
</li>
<li>
<p>-a 全部重新构建（命令源码文件与库源码文件）</p>
</li>
<li>
<p>-race 竞争检测</p>
</li>
<li>
<p><code>-gcflags="all=-N -l"</code></p>
<ol>
<li><code>-N</code> 取消优化</li>
<li><code>-l</code> 取消内联</li>
<li>
<p><code>-m</code> 逃逸分析，打印逃逸信息</p>
</li>
<li>
<p><code>go build -gcflags=-S fmt</code> 仅打印fmt包的反汇编信息</p>
</li>
<li>go build -gcflags=all=-S fmt' 打印fmt以及其依赖包的反汇编信息</li>
</ol>
</li>
<li>
<p>go build -buildmode
   - plugin 编译成.so插件，通过包 plugin 进行打开，获取符号
   - c-shared：使用该参数时会生成出来两个文件，一个.so文件，一个.h头文件 ，使用起来就和使用c 生成的库文件和模块文件一样使用。</p>
</li>
</ol>
<h3 id="go-run">go run</h3>
<p>编译后运行</p>
<h3 id="go-get">go get</h3>
<p>get 解析并将依赖项添加到当前开发模块，然后生成并安装它们。</p>
<ol>
<li>-u 更新</li>
<li>-d 仅下载</li>
</ol>
<h3 id="go-test">go test</h3>
<h3 id="go-tool">go tool</h3>
<ol>
<li>
<p>go tool asm file 将go汇编文件编译为 object（.o） 文件。</p>
</li>
<li>
<p>go tool compile file 将go文件编译为 .o 文件。</p>
</li>
<li>
<p>go tool compile -N -l -S  file 将文件编译为汇编代码</p>
<p>或者使用：go build -gcflags -S x.go</p>
<p>gcflags == go compile flags</p>
</li>
<li>
<p>go tool compile：处理go文件，执行词法分析、语法分析、汇编、编译，输出obj文件</p>
</li>
<li>
<p>go tool asm：处理汇编文件（.s文件），输出obj文件</p>
</li>
<li>
<p>go tool pack：打包package下的所有obj文件，输出.a文件</p>
</li>
<li>
<p>go tool link：链接不同package的.a文件，输出可执行文件</p>
</li>
<li>
<p>go tool objdump：反汇编obj文件</p>
</li>
<li>
<p>go tool nm：输出obj文件、.a文件或可执行文件中定义的符号</p>
</li>
</ol>
<h3 id="problems">problems</h3>
<ol>
<li>delve and go on grafana codebase error - decoding dwarf section info at offset 0x0: too short  需要重新编译，携带调试信息</li>
<li>不显示本地变量内容的问题，可以添加 go build 参数: -i -v -gcflags="all=-N -l"</li>
<li>加快 cockroachdb 的调试速度，将下面的文件
   cockroach-v2.1.0/src/github.com/cockroachdb/cockroach/Makefile
   修改为
   GOFLAGS      := -i -a -v -gcflags="all=-N -l"</li>
<li>不要使用 goland 的 attach 到进程调试方式，非常慢</li>
</ol>
<h1 id="go_2">Go 调试工具</h1>
<h3 id="dlv">dlv 调试</h3>
<ul>
<li>dlv debug ./main.go -- arg1 arg2      自动编译，然后开始调试</li>
<li>dlv exec ./main_debug -- arg1 arg2    启动调试，程序需要按-gcflags="all=-N -l"方式编译</li>
</ul>
<p>基本命令：</p>
<div class="highlight"><pre><span></span><code>help           打印帮助信息
c              继续
n              next
s              step
bt             调用栈
goroutine      切换goroutine
goroutines     显示所有goroutine
b main.go:2    打断点
cond 1 i==2    条件断点(在断点1上使用条件断点)
set            设置变量值
</code></pre></div>

<ol>
<li>掌握Debugger（以delve为例）的基本设置与常用命令：单步执行，跳入函数，跳出函数，设置断点，查看变量，查看寄存器，查看调用栈等</li>
<li>attach pid</li>
<li>connect 连接到调试服务器进行调试</li>
<li><code>dlv core &lt;executable&gt; &lt;core&gt;</code> 打开core文件和关联的可执行程序，检查进程出现core时的状态</li>
<li>dlv debug [package] 编译无优化程序，开始调试</li>
<li>dlv exec <path/to/binary> 调试已经编译好的程序（需要用参数-gcflags="all=-N -l" 编译调试版本）</li>
<li>dlv test [package] 编译无优化的测试程序，并开始调试</li>
<li>dlv trace [package] regexp 跟踪程序的执行，设置每个匹配的函数一个跟踪点，当跟踪点触发时打印信息。</li>
<li>调试命令：<ol>
<li>args 参考函数参数</li>
<li>break (b) 打断点</li>
<li>breakpoints (bp) 打印所有活跃断点的信息</li>
<li>call</li>
<li>clear 删除断点</li>
<li>clearall 删除多个断点</li>
<li><code>condition (cond) breakpoint-id x == 4</code>  设置条件断点</li>
<li>deferred 在一个deferred调用中执行命令</li>
<li>disassemble 反汇编</li>
<li>exit quit q</li>
<li>goroutine (gr) 显示或者切换当前的goroutine</li>
<li>goroutines 列出程序的所有goroutines</li>
<li>list </li>
<li><code>on breakpoint-name or id &lt;command&gt;</code> 断点触发时执行命令</li>
<li>单步执行（n），跳入函数（s），跳出函数（so），设置断点（b），查看变量（p x），查看寄存器（regs），bt</li>
</ol>
</li>
<li>通过合理的日志协助调试和定位问题</li>
<li>掌握pprof、trace工具，定位内存，并发，性能等复杂问题
   - go test ./main -bench . 进行基准测试（时间）
   - go test ./main -bench . -benchmem 进行基准测试（时间和内存）
   - go tool pprof
   - go tool trace 
   - GODEBUG=gctrace=1 跟踪gc情况</li>
<li>掌握core dump文件的生成和解析工具与方法</li>
</ol>
<h3 id="gdb">gdb调试</h3>
<p>Go 可以用 gdb 调试：</p>
<ol>
<li>dbinit中新增行：add-auto-load-safe-path /root/go/go/src/runtime/runtime-gdb.py
   或者 source /root/go/go/src/runtime/runtime-gdb.py </li>
<li>b github.com/bitkv/bitkv/pkg/server.(*Server).Get</li>
<li>info goroutines</li>
<li>goroutine 3 bt</li>
</ol>
<h3 id="_1">远程调试</h3>
<ol>
<li>
<p>启动 dlv 调试服务器，attach 到 go 应用程序
   dlv attach 69658 --headless --listen=:2345 --api-version=2</p>
</li>
<li>
<p>使用 goland 可以进行远程调试</p>
</li>
</ol>
<h1 id="go_3">Go 模块</h1>
<h2 id="1-go">1.  Go 模块介绍</h2>
<p>模块是相关 Go 包的集合，作为一个版本化的单元。模块记录依赖关系，并创建可重现的构建过程。</p>
<div class="highlight"><pre><span></span><code>Usage:

go mod &lt;command&gt; [arguments]

The commands are:

download    download modules to local cache
edit        edit go.mod from tools or scripts
graph       print module requirement graph
init        initialize new module in current directory
tidy        add missing and remove unused modules
vendor      make vendored copy of dependencies
verify      verify dependencies have expected content
why         explain why packages or modules are needed
</code></pre></div>

<h2 id="2">2. 使用</h2>
<h3 id="21">2.1 基本使用</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 前提：已经存在一个 github 下的项目 bitkv</span>

<span class="c1"># 将项目下载到任意位置(注意不要放到 $GOPATH 目录下)</span>
git clone github.com/bitkv/bitkv bitkv
<span class="nb">cd</span> bitkv

<span class="c1"># 初始化</span>
go mod init github.com/bitkv/bitkv

<span class="c1"># 自动生成 go.mod go.sum 两个文件</span>
go mod tidy

<span class="c1"># 如果不确定为什么会依赖某个模块，可以打开 go.mod 中查看，然后执行 why 命令分析</span>
go mod why github.com/pkg/errors
</code></pre></div>

<h3 id="22-go111module">2.2 GO111MODULE</h3>
<p>为了跟老版本兼容，环境变量 GO111MODULE 默认为 auto，意思是如果在 <code>$GOPATH</code> 所在的目录下，则不使用 Go 模块。</p>
<p>如果已经把项目放到<code>$GOPATH</code>所在的任何子目录下，需要设置</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">GO111MODULE</span><span class="o">=</span>on
</code></pre></div>

<p>在非 <code>$GOPATH</code> 所在的子目录下，则不需要设置。</p>
<h3 id="23-goproxy">2.3 GOPROXY</h3>
<p>由于国内访问部分网站的问题，在 go mod tidy 的过程中，可能会遇到访问 <code>golang.org</code> 等地址超时的问题，可以通过设置代理解决。Go 模块当前已经默认支持代理设置。</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.cn
</code></pre></div>

<h3 id="24">2.4 缓存</h3>
<p>下载的模块会保存对应版本到 <code>$GOPATH/pkg/mod</code> 目录下。</p>
<h2 id="3">3. 总结</h2>
<h2 id="_2">参考</h2>
<p><a href="https://github.com/golang/go/wiki/Modules">https://github.com/golang/go/wiki/Modules</a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2022 iswade
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>