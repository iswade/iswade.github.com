
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://iswade.github.io/translate/distsys/">
      
      <link rel="icon" href="../../themes/me.svg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>分布式系统大纲 - iswade's blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../themes/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="iswade&#39;s blog" class="md-header__button md-logo" aria-label="iswade's blog" data-md-component="logo">
      
  <img src="../../themes/me.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            iswade's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              分布式系统大纲
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="iswade&#39;s blog" class="md-nav__button md-logo" aria-label="iswade's blog" data-md-component="logo">
      
  <img src="../../themes/me.svg" alt="logo">

    </a>
    iswade's blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        主页
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          数据库
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="数据库" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/adb_nodes/00_index/" class="md-nav__link">
        高级数据库笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/buffer/buffer_details/" class="md-nav__link">
        PostgreSQL缓存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crdb/crdb_paper_cn/" class="md-nav__link">
        CockroachDB翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crdb/crdb_paper/" class="md-nav__link">
        CockroachDB论文
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../taurus_paper_cn/" class="md-nav__link">
        TaurusDB翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../taurus_paper/" class="md-nav__link">
        TaurusDB论文
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/pebble/" class="md-nav__link">
        PebbleKV存储引擎
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faunadb_transaction/" class="md-nav__link">
        FaunaDB分布式事务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Aurora_design_cloud_native_database/" class="md-nav__link">
        Aurora数据库
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../btree_vs_lsmtree/" class="md-nav__link">
        BTREEvsLSMTree
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/db_nodes/00_database_systems_2018/" class="md-nav__link">
        数据库笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../F1_query/" class="md-nav__link">
        F1 Query
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          分布式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="分布式" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          分布式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          分布式系统大纲
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        分布式系统大纲
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    为什么需要分布式?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    节点和网络
  </a>
  
    <nav class="md-nav" aria-label="节点和网络">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    节点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    消息流通的网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    因果关系图
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    同步网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    半同步网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    异步网络
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    当网络出错时
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    底层协议
  </a>
  
    <nav class="md-nav" aria-label="底层协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcp" class="md-nav__link">
    TCP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#udp" class="md-nav__link">
    UDP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    时钟
  </a>
  
    <nav class="md-nav" aria-label="时钟">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    墙上时钟
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lamport" class="md-nav__link">
    Lamport时钟
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    向量时钟
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gps" class="md-nav__link">
    GPS 和原子钟
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    可用性
  </a>
  
    <nav class="md-nav" aria-label="可用性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    完全可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    粘性可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    高可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    多数可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    量化可用性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    一致性
  </a>
  
    <nav class="md-nav" aria-label="一致性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    单调读
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    单调写
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    读自己
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    写后读
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    串行化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    因果一致性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    顺序一致性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    线性化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acid" class="md-nav__link">
    ACID隔离级别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    这实际上有什么关系吗？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    权衡
  </a>
  
    <nav class="md-nav" aria-label="权衡">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    可用性和一致性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    收获与收益
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    混合系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    尽可能避免共识
  </a>
  
    <nav class="md-nav" aria-label="尽可能避免共识">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calm" class="md-nav__link">
    CALM 猜想
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gossip" class="md-nav__link">
    Gossip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crdts" class="md-nav__link">
    CRDTs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hats" class="md-nav__link">
    HATs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    需要共识，怎么办？
  </a>
  
    <nav class="md-nav" aria-label="需要共识，怎么办？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#paxos" class="md-nav__link">
    Paxos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zab" class="md-nav__link">
    ZAB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#humming" class="md-nav__link">
    Humming共识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewstamped-replication" class="md-nav__link">
    Viewstamped Replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raft" class="md-nav__link">
    Raft
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    时延特征
  </a>
  
    <nav class="md-nav" aria-label="时延特征">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    多核系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    逻辑网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    地理复制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    常见的分布式系统
  </a>
  
    <nav class="md-nav" aria-label="常见的分布式系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    外置堆
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kv" class="md-nav__link">
    KV存储
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    SQL数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    搜索
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    协调服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    流系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    分布式队列
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    模式语言
  </a>
  
    <nav class="md-nav" aria-label="模式语言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    不要用分布式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    使用已经存在的分布式系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    永不故障
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    接受故障
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    备份
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    冗余
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    分片
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    独立的域
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    ID结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    不变的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    可变值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    汇合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    背压
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    域模型服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    结构遵循社交空间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    生产问题
  </a>
  
    <nav class="md-nav" aria-label="生产问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    您的文化支持分布式系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    测试一切
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    “这很慢”
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    测量一切
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    日志
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    影子流量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    版本
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    推广
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    特性标志
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    混沌工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    哦不，队列
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    进一步阅读
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/partition/" class="md-nav__link">
        数据分区
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../strong_consistency_models/" class="md-nav__link">
        强一致性模型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zookeeper/" class="md-nav__link">
        Zookeeper翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../paxos_made_live/" class="md-nav__link">
        PaxosMadeLive翻译
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          编程语言
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="编程语言" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          编程语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../articles/go_concurrency/" class="md-nav__link">
        Go并发编程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../go_interface/" class="md-nav__link">
        如何使用Go接口
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          软件工程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="软件工程" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          软件工程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/pragmatic_programmer/" class="md-nav__link">
        程序员修炼之道
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/bash_turorial/" class="md-nav__link">
        bash教程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linux_sysadmin/" class="md-nav__link">
        linux系统管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/git/" class="md-nav__link">
        git入门教程
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    为什么需要分布式?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    节点和网络
  </a>
  
    <nav class="md-nav" aria-label="节点和网络">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    节点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    消息流通的网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    因果关系图
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    同步网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    半同步网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    异步网络
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    当网络出错时
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    底层协议
  </a>
  
    <nav class="md-nav" aria-label="底层协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcp" class="md-nav__link">
    TCP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#udp" class="md-nav__link">
    UDP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    时钟
  </a>
  
    <nav class="md-nav" aria-label="时钟">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    墙上时钟
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lamport" class="md-nav__link">
    Lamport时钟
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    向量时钟
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gps" class="md-nav__link">
    GPS 和原子钟
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    可用性
  </a>
  
    <nav class="md-nav" aria-label="可用性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    完全可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    粘性可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    高可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    多数可用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    量化可用性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    一致性
  </a>
  
    <nav class="md-nav" aria-label="一致性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    单调读
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    单调写
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    读自己
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    写后读
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    串行化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    因果一致性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    顺序一致性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    线性化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acid" class="md-nav__link">
    ACID隔离级别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    这实际上有什么关系吗？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    权衡
  </a>
  
    <nav class="md-nav" aria-label="权衡">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    可用性和一致性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    收获与收益
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    混合系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    尽可能避免共识
  </a>
  
    <nav class="md-nav" aria-label="尽可能避免共识">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calm" class="md-nav__link">
    CALM 猜想
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gossip" class="md-nav__link">
    Gossip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crdts" class="md-nav__link">
    CRDTs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hats" class="md-nav__link">
    HATs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    需要共识，怎么办？
  </a>
  
    <nav class="md-nav" aria-label="需要共识，怎么办？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#paxos" class="md-nav__link">
    Paxos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zab" class="md-nav__link">
    ZAB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#humming" class="md-nav__link">
    Humming共识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewstamped-replication" class="md-nav__link">
    Viewstamped Replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raft" class="md-nav__link">
    Raft
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    时延特征
  </a>
  
    <nav class="md-nav" aria-label="时延特征">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    多核系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    逻辑网络
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    地理复制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    常见的分布式系统
  </a>
  
    <nav class="md-nav" aria-label="常见的分布式系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    外置堆
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kv" class="md-nav__link">
    KV存储
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    SQL数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    搜索
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    协调服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    流系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    分布式队列
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    模式语言
  </a>
  
    <nav class="md-nav" aria-label="模式语言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    不要用分布式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    使用已经存在的分布式系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    永不故障
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    接受故障
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    备份
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    冗余
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    分片
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    独立的域
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    ID结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    不变的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    可变值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    汇合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    背压
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    域模型服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    结构遵循社交空间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    回顾
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    生产问题
  </a>
  
    <nav class="md-nav" aria-label="生产问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    您的文化支持分布式系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    测试一切
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    “这很慢”
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    测量一切
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    日志
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    影子流量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    版本
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    推广
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    特性标志
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    混沌工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    哦不，队列
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    进一步阅读
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="_1">分布式系统大纲</h1>
<p>介绍分布式系统基础。直观地了解关键的分布式系统术语，概述算法领域，并探索生产环境的问题。</p>
<h2 id="_2">为什么需要分布式?</h2>
<p>Lamport, 1987:</p>
<blockquote>
<p>分布式系统是：你不知道存在计算机故障会导致您自己的计算机无法使用的系统。</p>
</blockquote>
<ul>
<li>首先，在托管中心运行*nix的盒子，进程通过 TCP 或者 UDP 通信。<ul>
<li>或者EC2, Rackspace的盒子等等</li>
<li>也许通过InfiniBand通信</li>
<li>以短距离的局域网分割</li>
<li>或者以数千公里互联网分割</li>
</ul>
</li>
<li>许多移动应用也参与分布式系统<ul>
<li>通过糟糕的网络进行通信<ul>
<li>桌面Web浏览器也是如此</li>
<li>这不仅仅是服务器 —— 它也是客户端</li>
</ul>
</li>
</ul>
</li>
<li>更一般地说，分布式系统具有如下特征<ul>
<li>由交互的组件构成</li>
<li>很慢</li>
<li>不可靠</li>
<li>无论那些对你意味着什么</li>
</ul>
</li>
<li>还有：<ul>
<li>飞机上的冗余CPU</li>
<li>ATM和销售点终端</li>
<li>太空探测器</li>
<li>支付账单</li>
<li>医生进行推荐</li>
<li>醉酒的朋友试图通过短信制定计划</li>
<li>每次商务会议</li>
</ul>
</li>
</ul>
<h2 id="_3">节点和网络</h2>
<ul>
<li>我们将分布式系统中的每个部分叫做 <em>节点</em><ul>
<li>也称之为进程，代理，参与者</li>
</ul>
</li>
</ul>
<h3 id="_4">节点</h3>
<ul>
<li>延迟特征<ul>
<li>在一个节点内部的操作很快</li>
<li>节点之间的操作很慢</li>
<li>快和慢取决于系统的目的</li>
</ul>
</li>
<li>节点是可靠的<ul>
<li>作为一个故障单元</li>
<li>知道什么时候发生问题</li>
<li>状态是连贯的</li>
<li>状态转换以优雅有序的方式进行</li>
<li>典型的模型是某种类型的单线程状态机</li>
</ul>
</li>
<li>节点可以自己组成一个分布式系统<ul>
<li>但只要该系统作为一个整体提供“快速，连贯”的操作，我们就可以将其视为单个节点。</li>
</ul>
</li>
<li>进程模型<ul>
<li>顺序进程通信模型</li>
<li>Pi-演算</li>
<li>Ambient演算</li>
<li>Actor模型</li>
</ul>
</li>
<li>节点故障模型<ul>
<li>故障停止 Crash-stop</li>
<li>故障恢复 Crash-recover</li>
<li>故障遗忘 Crash-amnesia</li>
<li>拜占庭 Byzantine</li>
</ul>
</li>
</ul>
<h3 id="_5">消息流通的网络</h3>
<ul>
<li>节点通过网络交互<ul>
<li>人类通过口头语言进行交互</li>
<li>粒子通过磁场交互</li>
<li>计算机通过IP，TCP，UDP，SCTP 或者其它协议交互</li>
</ul>
</li>
<li>在节点之间发送的离散 <em>消息</em> </li>
<li>消息需要 <em>时间</em> 来传播<ul>
<li>这是分布式系统中比较慢的一部分</li>
<li>我们称之为 <em>时延</em> </li>
</ul>
</li>
<li>消息可能会丢失<ul>
<li>这是分布式系统中另一个不可靠的部分。</li>
</ul>
</li>
<li>网络几乎不会是同构的<ul>
<li>一些连接比其它的连接速度更慢、带宽更小、更容易出错</li>
</ul>
</li>
</ul>
<h3 id="_6">因果关系图</h3>
<ul>
<li>我们可以将节点和网络交互表示为图表<ul>
<li>时间从左到右或者从上到下表示</li>
<li>节点是时间方向上的线（因为它们保持不动）</li>
<li>消息通过倾斜的路径 <em>连接</em> 节点</li>
</ul>
</li>
</ul>
<h3 id="_7">同步网络</h3>
<ul>
<li>节点以锁步方式执行：节点步骤之间的时间始终为1。</li>
<li>消息延迟有限</li>
<li>有效的完美的全球时钟</li>
<li>易于证明的<ul>
<li>你可能没有</li>
</ul>
</li>
</ul>
<h3 id="_8">半同步网络</h3>
<ul>
<li>像同步一样，但时钟只是近似的，例如 在 [c，1]</li>
</ul>
<h3 id="_9">异步网络</h3>
<ul>
<li>独立执行，无论何时：步进时间在[0,1]中的任何位置</li>
<li>无限制的消息延迟</li>
<li>没有全球时钟</li>
<li>比半同步或同步网络弱<ul>
<li>意味着某些算法效率不高</li>
<li>意味着某些算法是 <em>不可能的</em></li>
<li>参见例如 Attiya＆Mavronicolas，“半同步与异步网络的效率“</li>
</ul>
</li>
<li>IP网络肯定是异步的<ul>
<li>但 <em>在实践中</em> 真正的病态事情不会发生</li>
<li>大多数网络在几秒到几周内恢复，而不是“从不”<ul>
<li>相反，人类的时间尺度大约为几秒到几周</li>
<li>所以我们不能臆想不存在的问题</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="_10">当网络出错时</h2>
<ul>
<li>异步网络允许<ul>
<li>重复</li>
<li>延迟</li>
<li>丢失</li>
<li>重新排序</li>
</ul>
</li>
<li>丢失和延迟是很难区分的</li>
<li>拜占庭网络被允许随意弄乱消息<ul>
<li>包括重写内容</li>
<li>在真实的网络中几乎不会出现<ul>
<li>绝大部分情况</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="_11">底层协议</h2>
<h3 id="tcp">TCP</h3>
<ul>
<li>TCP <em>有效</em>。 用它。<ul>
<li>不完美; 你可以更快</li>
<li>但是你知道什么时候会这样</li>
</ul>
</li>
<li>实际上，TCP可以在单个TCP连接中防止重复和重新排序<ul>
<li>但是你可能会打开多个连接</li>
<li>如果没有其他原因，TCP 连接最终会失败</li>
<li>当发生这种情况时，你可以 a）错过消息；b）重试</li>
<li>您可以在TCP连接之上构建序列号来保证有序</li>
</ul>
</li>
</ul>
<h3 id="udp">UDP</h3>
<ul>
<li>与TCP相同的规则，但没有流的不变性</li>
<li>很多人都希望UDP “速度”<ul>
<li>不要认为路由器和节点可以并且会随意丢弃数据包</li>
<li>不要认为他们的包会被重复</li>
<li>并重新排序</li>
<li>“但至少它是公正的吗？”<ul>
<li>错了！</li>
</ul>
</li>
<li>这会导致各种各样的混乱，例如，指标收集</li>
<li>调试很难</li>
<li>TCP为您提供流量控制并将逻辑消息重新打包成数据包<ul>
<li>您需要重新构建流量控制和背压</li>
</ul>
</li>
<li>通过基于UDP的TLS很难</li>
</ul>
</li>
<li>在TCP有限状态机FSM开销过高的情况下，UDP非常有用<ul>
<li>内存压力</li>
<li>许多短连接和套接字重用</li>
</ul>
</li>
<li>在系统目标是尽力传输的场景下尤其有用<ul>
<li>语音通话：人们会道歉并重复自己</li>
<li>游戏：口吃和滞后，但后来会追上</li>
<li>更高级别的协议对底层的混乱增加了可靠性</li>
</ul>
</li>
</ul>
<h2 id="_12">时钟</h2>
<ul>
<li>当一个系统被分割为独立的部分时，我们还期望对事件有某种类型的顺序</li>
<li>时钟可以帮助我们排序：先是这个，然后是那个</li>
</ul>
<h3 id="_13">墙上时钟</h3>
<ul>
<li>在理论上，操作系统时钟给出了系统中事件的部分顺序<ul>
<li>警告: NTP并不是你想象的好</li>
<li>警告: 在节点之间肯定没有很好地同步</li>
<li>警告: 硬件可以漂移</li>
<li>警告：几个世纪以来<ul>
<li>NTP没有被关心</li>
<li><a href="http://rachelbythebay.com/w/2017/09/27/2153/">http://rachelbythebay.com/w/2017/09/27/2153/</a></li>
</ul>
</li>
<li>警告：NTP可能会往后跳变（默认：delta &gt;128ms）<ul>
<li><a href="https://www.eecis.udel.edu/~mills/ntp/html/clock.html">https://www.eecis.udel.edu/~mills/ntp/html/clock.html</a></li>
</ul>
</li>
<li>警告：POSIX定义上不是单调的<ul>
<li>Cloudflare 2017: 午夜时分闰秒意味着时间向后流动</li>
<li>当前，Go没有提供CLOCK_MONOTONIC的访问方式</li>
<li>计算一个负的持续时间，然后将其输入rand.int63n（），会panic</li>
<li>导致DNS解析失败：1％的HTTP请求受影响几个小时</li>
<li><a href="https://blog.cloudflare.com/how-and-why-the-leap-second-affected-cloudflare-dns/">https://blog.cloudflare.com/how-and-why-the-leap-second-affected-cloudflare-dns/</a></li>
</ul>
</li>
<li>警告：您想要测量的时间尺度可能无法实现</li>
<li>警告：线程可以睡眠</li>
<li>警告：运行时可以睡眠</li>
<li>警告：操作系统共可以睡眠</li>
<li>警告：硬件可以睡眠</li>
</ul>
</li>
<li>不要使用墙上时钟</li>
</ul>
<h3 id="lamport">Lamport时钟</h3>
<ul>
<li>Lamport 1977：“时间，时钟和分布式系统中事件的排序”<ul>
<li>每个进程一个时钟</li>
<li>每个状态转换，时间单调递增：<code>t'= t + 1</code></li>
<li>包含在发送的每条消息中</li>
<li><code>t'= max(t，t_msg + 1)</code></li>
</ul>
</li>
<li>如果我们有进程的全序，则我们可以对事件实现全序<ul>
<li>但那个顺序可能非常不直观</li>
</ul>
</li>
</ul>
<h3 id="_14">向量时钟</h3>
<ul>
<li>将Lamport时钟推广到所有进程时钟的向量</li>
<li><code>t_i'= max(t_i, t_msg_i)</code></li>
<li>对于每个操作，在向量中增加该进程的时钟</li>
<li>提供部分因果顺序<ul>
<li><code>A &lt; B iff all A_i &lt;= B_i</code>，并且至少一个 <code>A_i &lt;B_i</code></li>
<li>具体而言，给定一对事件，我们可以确定因果关系<ul>
<li>B的原因是A，则意味着 A &lt; B</li>
<li>A的原因是B，则意味着 B &lt; A</li>
<li>否则独立</li>
</ul>
</li>
</ul>
</li>
<li>务实地：过去是共享的; 现在是独立的<ul>
<li>只有“现在”，需要保留独立状态</li>
<li>祖先状态可以被丢弃</li>
<li>让我们对过去做垃圾收集</li>
</ul>
</li>
<li>空间：O（进程数）<ul>
<li>对于GC需要协调</li>
<li>或者牺牲正确性并修剪旧的vclock条目</li>
</ul>
</li>
<li>变种<ul>
<li>虚线版本矢量 - 用于客户端/服务器系统，对更多的事件排序</li>
<li>间隔树时钟 - 用于进程进入和离开</li>
</ul>
</li>
</ul>
<h3 id="gps">GPS 和原子钟</h3>
<ul>
<li>比NTP好<ul>
<li>毫秒精度的全球分布的全序</li>
<li>将异步网络提升为半同步网络</li>
<li>解锁了更多高效算法</li>
</ul>
</li>
<li>当前只有Google有这个能力<ul>
<li>Spanner：全球分布的强一致事务</li>
<li>并且他们不共享</li>
</ul>
</li>
<li>比你想要的要贵<ul>
<li>每个GPS几百个接受者</li>
<li>原子钟用于本地的正确性：<code>$$$$?</code></li>
<li>需要多个类型的GPS：供应商可能会出错<ul>
<li>我不知道是谁在做这件事，但我敢打赌数据中心</li>
<li>未来将为有限精度时间提供专用的硬件接口</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="_15">回顾</h2>
<p>我们已经介绍了分布式系统的基本原理。节点通过网络交换消息，节点和网络都可能以各种方式失败。TCP和UDP等协议为我们提供了原始信道通信流程，我们可以使用时钟排序时间。现在，我们会讨论分布式系统的一些高级 <em>属性</em>。</p>
<h2 id="_16">可用性</h2>
<ul>
<li>可用性基本上是尝试成功操作的一部分</li>
</ul>
<h3 id="_17">完全可用</h3>
<ul>
<li>原始想法：每次操作都成功</li>
<li>一致性：非故障节点上的每个操作都成功<ul>
<li>您无法对故障节点做任何事情</li>
</ul>
</li>
</ul>
<h3 id="_18">粘性可用</h3>
<ul>
<li>对于非故障节点每次操作都成功<ul>
<li>约束：客户端总是可以和相同的节点交互</li>
</ul>
</li>
</ul>
<h3 id="_19">高可用</h3>
<ul>
<li>最好，如果系统没有被分布。</li>
<li>例如 容忍多达f次失败，但不能再多</li>
<li>也许有些操作失败了</li>
</ul>
<h3 id="_20">多数可用</h3>
<ul>
<li>如果操作的节点可以跟集群中的多数通信，则操作可以成功</li>
<li>操作少数节点会失败</li>
</ul>
<h3 id="_21">量化可用性</h3>
<ul>
<li>我们谈论了很多 <em>运行时间</em><ul>
<li>如果没有人用，系统是运行的吗？</li>
<li>在高峰时期会比宕机更差吗？</li>
<li>可以 “在时间窗口内满足的请求的比例” 做衡量</li>
<li>然后在不同时间在窗口上绘制该比例</li>
<li>时间刻度会影响报告的正常运行时间</li>
</ul>
</li>
<li>Apdex 是基于设定阈值的响应时间的度量</li>
<li>不是所有的成功都是等价的</li>
<li>将操作分为 “OK”，“meh”和“糟糕”</li>
<li>Apdex = P(OK) + P(meh) / 2</li>
<li>可以每年报告<ul>
<li>“我们今年达到了99.999 apdex”</li>
</ul>
</li>
<li>并且在更精细的时间尺度上！<ul>
<li>“用户服务的Apdex刚下降到0.5;页面操作！”</li>
</ul>
</li>
<li>理想情况：您的服务提供的整体很好？</li>
</ul>
<h2 id="_22">一致性</h2>
<ul>
<li>一致性模型是系统中事件的“安全”历史集</li>
</ul>
<h3 id="_23">单调读</h3>
<ul>
<li>一旦我读取了一个值，任何后续读取都将返回该状态或以后的值</li>
</ul>
<h3 id="_24">单调写</h3>
<ul>
<li>如果进行写操作，所做的任何后续写操作都将在第一次写入后的值上写入</li>
</ul>
<h3 id="_25">读自己</h3>
<ul>
<li>一旦一个值写入后，任何后续的读取都会返回写入的值（或者后续的值）</li>
</ul>
<h3 id="_26">写后读</h3>
<ul>
<li>一旦一个值被读取，后续的写入只会在读取后的位置进行</li>
</ul>
<h3 id="_27">串行化</h3>
<ul>
<li>所有的操作（事务）都是原子执行的</li>
<li>以某种顺序</li>
<li>对顺序没有限制</li>
<li>例如可以从过去的历史读取也没有问题</li>
</ul>
<h3 id="_28">因果一致性</h3>
<ul>
<li>假设操作可以由DAG因果关系连接<ul>
<li>例如，读取之后的写入与因果关系有关</li>
<li>假设进程不只是丢弃读取数据</li>
<li>该DAG中未连接的操作是 <em>并发的</em></li>
</ul>
</li>
<li>约束：在进程可以执行操作之前，所有之前的操作已经在该节点上执行</li>
<li>并发操作可以自由重新排序</li>
</ul>
<h3 id="_29">顺序一致性</h3>
<ul>
<li>跟因果一致性类似，限制了可能的顺序</li>
<li>所有操作必须原子执行</li>
<li>所有进程对操作的顺序达成一致</li>
<li>对于一个进程而言，操作总是按顺序出现</li>
<li>但是节点可以落后</li>
</ul>
<h3 id="_30">线性化</h3>
<ul>
<li>所有操作必须原子执行</li>
<li>每个进程对操作顺序达成一致</li>
<li>每个操作必须在调用和完成时间之间进行</li>
<li>实时性，玩不的约束可以让我们构建强壮的系统</li>
</ul>
<h3 id="acid">ACID隔离级别</h3>
<ul>
<li>ANSI SQL的ACID隔离级别是很奇怪的</li>
<li>基本上是已有厂商实现的效果</li>
<li>规范中的定义含糊不清</li>
<li><a href="http://pmg.csail.mit.edu/papers/adya-phd.pdf">Adya 1999：Weak Consistency: A Generalized Theory and Optimistic Implementations for Distributed Transactions</a></li>
<li>每个ANSI SQL隔离级别都禁止出现奇怪的现象</li>
<li>读未提交<ul>
<li>防止P0：脏写</li>
<li>w1(x) ... w2(x)</li>
<li>在提交之前，无法覆盖其他事务的数据</li>
<li>在事务仍在修改时可以读取数据</li>
<li>可以读取即将回滚的数据</li>
</ul>
</li>
<li>读已提交<ul>
<li>防止P1：脏读</li>
<li>w1(x) ... r2(x)</li>
<li>不能读取一个事务未提交的值</li>
</ul>
</li>
<li>可重复读<ul>
<li>防止P2：模糊读 (update)</li>
<li>r1(x) ... w2(x)</li>
<li>一旦一个事务读取到一个值，事务在提交之前都不能变</li>
</ul>
</li>
<li>串行化<ul>
<li>防止P3：幻读 (select id &lt; 2 from t; insert into t values(1);)</li>
<li>给出一些条件P</li>
<li>r1(x) ... w2(y in P)</li>
<li>一旦读取了满足查询条件的集合，这个集合不能变化，直到事务提交</li>
<li>不仅仅是值，是那些会参与到集合中的值</li>
</ul>
</li>
<li>游标稳定<ul>
<li>事务有一个游标的集合</li>
<li>一个游标引用一个事务访问的对象</li>
<li>持有读锁，直到游标被释放或者提交</li>
<li>在提交的时，游标被升级为写锁</li>
<li>防止丢失更新</li>
</ul>
</li>
<li>快照隔离<ul>
<li>事务总是从已经提交的快照读取数据，快照从事务开始时获取</li>
<li>仅当没有其他具有重叠[start..commit]间隔的已提交事务已写入我们编写的任何对象时，才会发生提交</li>
<li>第一个提交者成功</li>
</ul>
</li>
</ul>
<h3 id="_31">这实际上有什么关系吗？</h3>
<ul>
<li>真实世界并不是那样并发的</li>
<li>很多公司选择读已提交</li>
<li>但恶意攻击者可以诱导并发</li>
<li>Flexcoin<ul>
<li>比特币交换，允许用户通过在账户之间进行混洗来创造资金</li>
<li>2014年遭遇袭击，365,000英镑被盗</li>
<li>交易所完全崩溃了</li>
</ul>
</li>
<li>Poloniex<ul>
<li>并发提款被错误地隔离，允许用户超支</li>
<li>安全审核未发现负余额</li>
<li>12.3％的外汇资金被盗; 损失在用户之间传播</li>
</ul>
</li>
<li><a href="http://www.bailis.org/papers/acidrain-sigmod2017.pdf">Warszawski＆Bailis 2017：Acidrain</a><ul>
<li>自动识别Web应用程序中的一致性违规</li>
<li>例如 购买一张礼品卡，然后无限次使用</li>
<li>例如 购买笔，在结账时添加笔记本电脑到购物车，获得免费的笔记本电脑</li>
<li>超过50％的电子商务网站中都存在漏洞</li>
<li>弱DB隔离默认值</li>
<li>交易范围的不当使用</li>
<li>未能使用任何交易</li>
</ul>
</li>
</ul>
<h2 id="_32">权衡</h2>
<ul>
<li>理想情况下，我们需要完全可用性和线性化</li>
<li>一致性需要协调<ul>
<li>如果允许每个顺序，我们不需要做任何工作！</li>
<li>如果我们想要禁止某些事件顺序，我们必须交换消息</li>
</ul>
</li>
<li>协调（通常）都有代价<ul>
<li>更多的一致性更慢</li>
<li>更多的一致性更直观</li>
<li>更多的一致性更少的可用性</li>
</ul>
</li>
</ul>
<h3 id="_33">可用性和一致性</h3>
<ul>
<li>CAP理论：线性化或者完全可用</li>
<li>但是等等，这里还有更多！</li>
<li>Bailis 2014：Highly Available Transactions: Virtues and Limitations</li>
<li>其他理论不允许完全可用或粘性可用......<ul>
<li>强串行化</li>
<li>串行化</li>
<li>可重复读</li>
<li>游标稳定</li>
<li>快照隔离</li>
</ul>
</li>
<li>你可以粘性可用...<ul>
<li>因果关系</li>
<li>PRAM</li>
<li>读后写</li>
</ul>
</li>
<li>你可以完全可用...<ul>
<li>读未提交</li>
<li>读已提交</li>
<li>单调原子视图</li>
<li>写后读</li>
<li>单调读</li>
<li>单调写</li>
</ul>
</li>
</ul>
<h3 id="_34">收获与收益</h3>
<ul>
<li>Fox &amp; Brewer, 1999: Harvest, Yield, and Scalable Tolerant Systems</li>
<li>收益：请求完成的概率</li>
<li>收获：响应中反映的数据部分</li>
<li>例子<ul>
<li>搜索引擎中的节点故障可能导致某些结果丢失</li>
<li>更新可能反映在某些节点上，但不反映在其他节点上</li>
<li>考虑一个被分区的AP系统</li>
<li>你可以写入数据一些人不能读取到</li>
<li>流式视频降级以保持低延迟</li>
</ul>
</li>
<li>这不是违反安全不变量的借口<ul>
<li>只是帮助您量化您可以 <em>超过</em> 安全不变量的数量</li>
<li>例如，99%时间，你可以读取到前面90%的写入</li>
</ul>
</li>
<li>强依赖负载，硬件，拓扑，等</li>
<li>可以根据每个请求调整收获与收益<ul>
<li>尽可能在10ms以内</li>
<li>我需要一切，我理解你可能不会应答</li>
</ul>
</li>
</ul>
<h3 id="_35">混合系统</h3>
<ul>
<li>有一系列的选择</li>
<li>不同部分设施有不同的需求</li>
<li>选择可以满足你的约束最弱的模型<ul>
<li>但是考虑概率界限，可见性延迟可能会令人望而却步</li>
<li>请参阅Dynamo Quorums中的概率有界陈旧性</li>
</ul>
</li>
<li>不是所有的数据都是一样的</li>
<li>大数据通常不是很重要</li>
<li>小数据通常很重要</li>
<li>线性化用户的操作，因果关一致性社交信息</li>
</ul>
<h3 id="_36">回顾</h3>
<p>可用性衡量运营成功的频率。 一致性模型是管理可能发生的操作以及何时发生的规则。 更强的一致性模型通常以性能和可用性为代价。 接下来，我们将讨论构建系统的不同方法，从弱到强一致性。</p>
<h2 id="_37">尽可能避免共识</h2>
<h3 id="calm">CALM 猜想</h3>
<ul>
<li>Consistency As Logical Monotonicity</li>
<li>如果你可以证明一个系统是逻辑单调的，则不需要协调</li>
<li>什么是“协调”？</li>
<li>
<p>什么是“单调”？</p>
</li>
<li>
<p>单调性，非正式的，是不会回退的</p>
</li>
<li>从部分信息推论永远不会因为新信息而无效</li>
<li>
<p>没有否定的关系代数和Datalog是单调的</p>
</li>
<li>
<p>Ameloot, et al, 2011: Relational transducers for declarative networking</p>
</li>
<li>理论上，不知道网络范围的无协调网络进程只能计算Datalog中的单调查询<ul>
<li>这读起来不容易</li>
</ul>
</li>
<li>无协调并不意味着没有通信<ul>
<li>即使面对任意水平分区，Algo也能成功</li>
</ul>
</li>
<li>用非常宽松的实际术语<ul>
<li>尝试说明您的问题，以便您只<em>向系统添加</em>新的事实</li>
<li>当您根据当前已知的事物计算新事实时，您是否可以确保永远不会撤回事实？</li>
<li>考虑特殊的“密封事实”，将一系列事实标记为完整</li>
<li>这些“仅增长”算法通常更容易实现</li>
<li>可能的权衡：不完整的读取</li>
</ul>
</li>
<li>Bloom语言<ul>
<li>使用flow分析进行无序编程</li>
<li>可以告诉你那里需要协调</li>
</ul>
</li>
</ul>
<h3 id="gossip">Gossip</h3>
<ul>
<li>消息广播系统</li>
<li>对于集群管理、服务发现、健康、传感器、CDN等很有用</li>
<li>通用的若一致性/高可用</li>
<li>全球广播</li>
<li>发送消息给每个其它节点</li>
<li>O(节点数)</li>
<li>网状网络</li>
<li>流行病模型</li>
<li>与邻居接力</li>
<li>传播时间按最大自由路径的顺序排列</li>
<li>生成森林</li>
<li>替代网络，使用树</li>
<li>跳到连接节点，该节点继续连接到其他连接节点</li>
<li>减少多余的消息</li>
<li>减少时延</li>
<li>Plumtree (Leit ̃ao, Pereira, &amp; Rodrigues, 2007: Epidemic Broadcast Trees)</li>
<li>Push-Sum等</li>
<li>来自您收到数据的每个人的总和输入</li>
<li>将其广播到随机对等体</li>
<li>最小值，最大值，平均值的扩展</li>
<li>有助于实时指标，速率限制，路由，识别群集热点</li>
</ul>
<h3 id="crdts">CRDTs</h3>
<ul>
<li>无序的数据类型</li>
<li>计数器，集合，映射等等</li>
<li>容忍欺骗，延迟和重新排序</li>
<li>与顺序一致的系统不同，没有“单一的事实来源”</li>
<li>但不像天真最终一致的系统，永远不会丢失信息</li>
<li>除非你明确让他们丢失信息</li>
<li>在高可用系统中工作的很好</li>
<li>网页/移动客户端</li>
<li>Dynamo</li>
<li>Gossip</li>
<li>INRIA: Shapiro, Preguiça, Baquero, Zawirski, 2011: "A comprehensive study of Convergent and Commutative Replicated Data Types"</li>
<li>由数据类型X和合并函数m组成，是：<ul>
<li>关联：m(x1, m(x2, x3)) = m(m(x1, x2), x3)</li>
<li>交换：m(x1, x2) = m(x2, x1)</li>
<li>幂等：m(x1, x1) = m(x1)</li>
</ul>
</li>
<li>容易构建。容易推理。 摆脱各种头痛的问题。</li>
<li>沟通失败了吗？ 重试！ 它会收敛！</li>
<li>消息是否无序到达？ 没关系！</li>
<li>如何同步两个副本？ 合并！</li>
<li>缺点</li>
<li>有些算法<em>需要</em>顺序，不能用CRDT表示</li>
<li>读取可能是任意旧值</li>
<li>更高的空间成本</li>
</ul>
<h3 id="hats">HATs</h3>
<ul>
<li>Bailis, Davidson, Fekete, et al, 2013: "Highly Available Transactions, Virtues and Limitations"</li>
<li>从任何副本确保响应</li>
<li>低延迟（比可序列化协议快1-3个数量级！）</li>
<li>读已提交</li>
<li>单调原子视图</li>
<li>非常适用于可交换/单调系统</li>
<li>多个项更新的外键约束</li>
<li>有限的唯一性约束</li>
<li>可以确保给定任意有限延迟的收敛（“最终一致性”）</li>
<li>地理分布系统的良好候选</li>
<li>可能最好与更强大的事务系统协调一致</li>
<li>另见：COPS，Swift，Eiger，Calvin等</li>
</ul>
<h2 id="_38">需要共识，怎么办？</h2>
<ul>
<li>共识问题</li>
<li>三种进程类型<ul>
<li>提议者：提出一个值</li>
<li>接受者：选择一个值</li>
<li>学习者：读取选择的值</li>
</ul>
</li>
<li>接受者的分类<ul>
<li>N个接受者</li>
<li>F个允许失败</li>
<li>M个恶意的接受者</li>
</ul>
</li>
<li>
<p>三个变体</p>
<ul>
<li>非平凡性：只能学习提出的值</li>
<li>安全性：最多可以学习一个值</li>
<li>活跃性：如果一个提议者p，一个学习者l和一组N-F各接受者没有错误并且可以相互通信，并且如果p提出一个值，则l最终将学习一个值。</li>
</ul>
</li>
<li>
<p>系统类型与共识问题等价</p>
</li>
<li>所以我们这里的任何证明也适用于那些系统</li>
<li>锁服务</li>
<li>排序的日志</li>
<li>
<p>复制状态机</p>
</li>
<li>
<p>FLP告诉我们不可能在异步网络中实现共识</p>
</li>
<li>在正确的时间杀死一个进程，你可以打破<em>任何</em>共识算法</li>
<li>是这样，但情况也不是你想的那样坏</li>
<li>实际上，网络<em>通常足以</em>达成共识</li>
<li>
<p>此外，FLP假设确定的进程</p>
<ul>
<li>实际的计算机系统不是确定的</li>
<li>Ben-Or 1983: "Another Advantage of free choice"</li>
<li>非确定性算法<em>可以</em>达成共识</li>
</ul>
</li>
<li>
<p>Lamport 2002: tight bounds for asynchronous consensus</p>
</li>
<li>至少有两个提议者或一个恶意提议者，N&gt; 2F + M<ul>
<li>需要大多数</li>
</ul>
</li>
<li>
<p>对于至少2个提议者或一个恶意提议者，学习提案至少需要2个消息延迟。</p>
</li>
<li>
<p>这是一个实用的可操作范围</p>
</li>
<li>在稳定的集群中，可以使用一次往返大多数节点的方式。</li>
<li>群集转换期间需要更多。</li>
</ul>
<h3 id="paxos">Paxos</h3>
<ul>
<li>Paxos是共识算法的黄金标准</li>
<li>Lamport 1989 - The Part Time Parliament<ul>
<li>对想象中的希腊民主的描述方式来写作</li>
</ul>
</li>
<li>Lamport 2001 - Paxos Made Simple<ul>
<li>“用于实现容错分布式系统的Paxos算法一直被认为难以理解，也许是因为原始表示对于许多读者来说是希腊语[5]。事实上，它是最简单和最明显的分布式算法之一。 最后一节解释了完整的Paxos算法，它是通过直接应用协议来建立分布式系统的状态机方法得到的 - 这种方法应该是众所周知的，因为它是最可能的主题。 经常被引用的关于分布式系统理论的文章[4]。“</li>
</ul>
</li>
<li>Google 2007 - Paxos Made Live<ul>
<li>生产谷歌锁定服务Chubby的笔记</li>
</ul>
</li>
<li>Van Renesse 2011 - Paxos Made Moderately Complex<ul>
<li>事实证明你必须优化</li>
<li>伪代码也会有所帮助</li>
<li>一个伪代码页  -&gt; 几千行C ++</li>
</ul>
</li>
<li>就独立提案达成共识</li>
<li>通常部署在多数仲裁中，5或7个节点</li>
<li>几个优化</li>
<li>Multi-Paxos</li>
<li>Fast Paxos</li>
<li>Generalized Paxos</li>
<li>并不总是清楚使用哪种优化，哪些可以安全地组合</li>
<li>每种实现都使用略有不同的风格</li>
<li>Paxos实际上更像是一系列算法，而不是一个描述良好的单一实体</li>
<li>用于各种生产系统</li>
<li>Chubby</li>
<li>Cassandra</li>
<li>Riak</li>
<li>FoundationDB</li>
<li>WANdisco SVN servers</li>
<li>新研究：Paxos法定人数不需要占多数：可以优化快速阶段2法定人数 <a href="https://arxiv.org/abs/1608.06696">Howard, Malkhi, and Spiegelman</a></li>
<li>我们还不确定如何使用它</li>
<li>持久性仍然需要分发</li>
<li>新研究：<a href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-935.html">Distributed consensus revised</a></li>
<li>一般化共识</li>
</ul>
<h3 id="zab">ZAB</h3>
<ul>
<li>ZAB是Zookeeper原子广播协议</li>
<li>Junqueira, Reed, and Serafini 2011 - Zab: High-performance broadcast for primary-backup systems</li>
<li>与Paxos有区别</li>
<li>提供顺序一致性（可线性化写入，滞后有序读取）</li>
<li>很有用，因为ZK客户端通常需要快速本地读取</li>
<li>但是还有一个SYNC命令可以保证实时可见性</li>
<li>（SYNC + op）允许线性化读取</li>
<li>仍然是多数派，5个或者7个节点</li>
</ul>
<h3 id="humming">Humming共识</h3>
<ul>
<li>用于管理分布式系统重新配置的元数据存储</li>
<li>看起来有点像CORFU的复制日志</li>
<li>另见：链式复制</li>
</ul>
<h3 id="viewstamped-replication">Viewstamped Replication</h3>
<ul>
<li>作为复制协议提供，但也是共识算法</li>
<li>事务处理加视图变更算法</li>
<li>保证多数达成的值可以将来继续生存</li>
<li>我不知道任何生产系统，但是我不确定它们与Paxos一起以某种方式影响了Raft</li>
</ul>
<h3 id="raft">Raft</h3>
<ul>
<li>Ongaro &amp; Ousterhout 2014 - In Search of an Understandable Consensus Algorithm</li>
<li>Lamport说Paxos很容易，但我们仍然有各种问题</li>
<li>如果有一个我们可以理解的一致性算法怎么办？</li>
<li>当我们<em>想要</em>是状态机时，Paxos接近独立决策</li>
<li>改为维护状态机转换的复制<em>日志</em></li>
<li>还构建了集群成员转换，这对于真实系统来说是关键</li>
<li>非常新，但是我们有一个核心算法的 Coq 证明</li>
<li>可用于顺序或可线性化的状态机</li>
<li>RethinkDB</li>
<li>etcd</li>
<li>Consul</li>
<li>CockroachDB</li>
</ul>
<h2 id="_39">回顾</h2>
<p>只添加而不是收回的系统需要较少的协调就能构建。我们可以使用gossip系统向其他进程广播消息，CRDT用于合并来自对端的更新，以及用于弱隔离事务的HAT。可串行化和线性化需要<em>共识</em>，我们可以通过Paxos，ZAB，VR或Raft获得。现在，我们将讨论分布式系统的不同规模。</p>
<h2 id="_40">时延特征</h2>
<ul>
<li>时延不会为0</li>
<li>带宽一直在增加，但是正在接近光和电子的物理极限</li>
<li>延迟预算决定了您的系统设计<ul>
<li>你能负担多少个网络电话？</li>
</ul>
</li>
<li>对于慢，不同类型的系统有不同的定义</li>
<li>不同的目标</li>
<li>不同的算法</li>
</ul>
<h3 id="_41">多核系统</h3>
<ul>
<li>多核（尤其是NUMA）架构是类似的分布式系统</li>
<li>节点不会病态故障，但是消息传递很慢</li>
<li>同步网络通过一个总线提供（例如，Intel QPI）</li>
<li>硬件和微代码中的整个复杂的协议集使内存看起来很清晰</li>
<li>非临时存储指令（例如，MOVNTI）</li>
<li>提供了屏蔽分布特性的抽象</li>
<li>MFENCE/SFENCE/LFENCE<ul>
<li>引入针对加载/存储指令的序列化点</li>
<li>延迟特征： ~100周期 / ~30ns</li>
<li>依赖硬件，cache，指令等等</li>
</ul>
</li>
<li>CMPXCHG 比较和设置（顺序一致修改内存）</li>
<li>LOCK<ul>
<li>锁定整个跨核心的内存子系统！</li>
</ul>
</li>
<li>但是抽象的同时也伴随着开销（abstractions come with costs）</li>
<li><a href="https://en.wikipedia.org/wiki/Transactional_Synchronization_Extensions#Hardware_Lock_Elision">HLE</a>可能会有所帮助，但尚未成熟</li>
<li><a href="https://mechanical-sympathy.blogspot.com/">Blog: Mechanical Sympathy</a></li>
<li>在可能的地方，避免协调</li>
<li>上下文转换（进程或者线程）代价很高</li>
<li>当编写多线程程序时，将你的工作切分成独立的块<ul>
<li>尝试将内存屏障与工作单元边界对齐</li>
<li>允许处理器在工作单元内尽可能多地cheat</li>
<li>See Danica Porobic, 2016: <a href="https://infoscience.epfl.ch/record/219117/files/EPFL_TH7023.pdf">High Performance Transaction Processing on Non-Uniform Hardware Topologies</a></li>
</ul>
</li>
</ul>
<h3 id="_42">逻辑网络</h3>
<ul>
<li>你通常会在局域网内部部署复制系统</li>
<li>消息延迟可以低至100us</li>
<li>但是，在任何规模较大的网络（EC2）中，最少在ms范围</li>
<li>又是，包可能会被延迟五分钟</li>
<li>对这种情况需要做规划</li>
<li>与未命中缓存的磁盘查找相比，网络在一个数量级内</li>
<li>或者更快，在EC2中<ul>
<li>EC2磁盘延迟大约是20ms</li>
<li>200ms ?</li>
<li>20000ms ?<ul>
<li>但是EBS实际是其它计算机</li>
<li>LMAO 如果你认为EC2中一切都是真实的</li>
<li>等等，实际的磁盘也会这样做？<ul>
<li>什么是IO调度程序？</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>但是网络比内存/计算更慢</li>
<li>如果你的目标是吞吐量，工作单位应该花费超过一毫秒</li>
<li>但是分布还有其它原因<ul>
<li>资源分片</li>
<li>隔离故障</li>
</ul>
</li>
</ul>
<h3 id="_43">地理复制</h3>
<ul>
<li>全球范围部署的两个原因</li>
<li>最终用户的延迟<ul>
<li>人类可以探测到 ~10ms的延迟，容忍 ~100ms的延迟</li>
<li>SF--Denver: 50ms</li>
<li>SF--Tokyo: 100ms</li>
<li>SF--Madrid: 200ms</li>
</ul>
</li>
<li>灾难恢复<ul>
<li>数据中心是很好的，但是不是完美的</li>
<li>飓风是一个问题</li>
<li>整个亚马逊的区域可能会故障</li>
<li>是的，是区域，不是可用区(AZ)</li>
</ul>
</li>
<li>最少一轮的共识</li>
<li>差的情况下可能需要4轮<ul>
<li>如果你有一个糟糕的Paxos 实现（例如Cassandra），也许总是4轮</li>
</ul>
</li>
<li>所以如果想在数据中心之间使用Paxos，准备好应对这种开销</li>
<li>因为最小的延迟比用户可容忍的延迟还要高<ul>
<li>cache cache cache</li>
<li>写入队列，异步传递</li>
<li>考虑减少一致性保证以换取低延迟</li>
<li>CRDT 可以保证安全的本地写入</li>
<li>因果一致性和HAT可以成为好的方式</li>
</ul>
</li>
<li>强一致性呢？<ul>
<li>地理分布的服务具有天然的分裂性</li>
<li>EU用户在EU服务器上；US用户在US的服务器上</li>
<li>使用共识在不同的数据中心中间迁移用户</li>
</ul>
</li>
<li>固定/代理 更新到所在地数据中心<ul>
<li>很有希望是最近的数据中心</li>
<li>但也可能不是。我认为Facebook仍然将所有写入推送到一个数据中心</li>
</ul>
</li>
<li>当顺序一致性没问题时，将读取在本地缓存<ul>
<li>你可能已经在单个数据中心中使用缓存</li>
</ul>
</li>
</ul>
<h3 id="_44">回顾</h3>
<p>我们讨论了分布式系统的三个特征尺度：与同步网络耦合的多核处理器，由LAN链接的计算机，以及通过互联网或专用光纤链接的数据中心。 CPU的主要后果是性能问题：了解如何最小化协调。 在LAN上，在用户注意到之前，延迟对于许多网络跃点来说足够短。 在地理复制系统中，高延迟最终会推动一致的固定数据中心的解决方案。</p>
<h2 id="_45">常见的分布式系统</h2>
<h3 id="_46">外置堆</h3>
<ul>
<li>Redis，memcached，...</li>
<li>数据适合放到内存中，复杂的数据结构</li>
<li>当你的数据结构的内置数据结构很慢/丑陋时很有用</li>
<li>跟缓存一样优秀</li>
<li>或者作为平台之间共享状态的快速便捷的暂存器</li>
<li>不是特别安全</li>
</ul>
<h3 id="kv">KV存储</h3>
<ul>
<li>Riak，Couch，Mongo，Cassandra，RethinkDB，HDFS，...</li>
<li>通常1,2,3维度的键</li>
<li>O(1)访问时间，又是O(range)根据ID的范围扫描</li>
<li>值之间没有强依赖关系</li>
<li>对象可以是不透明的或结构化的</li>
<li>大数据集</li>
<li>通常是可线性扩展的</li>
<li>通常没有事务</li>
<li>一致性模型范围 - 通常是可选的线性化/顺序操作</li>
</ul>
<h3 id="sql">SQL数据库</h3>
<ul>
<li>Postgres, MySQL, Percona XtraDB, Oracle, MSSQL, VoltDB, CockroachDB, ...</li>
<li>通过关系代数定义：restrictions of products of records 等</li>
<li>中等大小的数据集</li>
<li>通常包含多记录事务</li>
<li>关系和事务需要协调，减少扩展性</li>
<li>许多系统是主从切换</li>
<li>访问代价依赖索引</li>
<li>典型的强一致性（SI，可串行化，阉割的可串行化）</li>
</ul>
<h3 id="_47">搜索</h3>
<ul>
<li>Elasticsearch, SolrCloud, ...</li>
<li>索引引用的文件</li>
<li>中等到很大的数据集</li>
<li>使用O(1)文档访问，日志类型的搜索</li>
<li>很好的扩展性</li>
<li>典型的若一致性</li>
</ul>
<h3 id="_48">协调服务</h3>
<ul>
<li>Zookeeper、ETCD、Consul，...</li>
<li>典型的强（顺序或者线性化）一致性</li>
<li>小数据集</li>
<li>作为无状态服务的协调原语很有用</li>
</ul>
<h3 id="_49">流系统</h3>
<ul>
<li>Storm、Spark ...</li>
<li>通常是定制设计、或者使用工具包来构建</li>
<li>典型的小内存数据容量</li>
<li>低延迟</li>
<li>高吞吐</li>
<li>若一致性</li>
</ul>
<h3 id="_50">分布式队列</h3>
<ul>
<li>Kafka, Kestrel, Rabbit, IronMQ, ActiveMQ, HornetQ, Beanstalk, SQS, Celery, ...</li>
<li>在多个节点将日志写入磁盘来实现冗余</li>
<li>当您需要立即确认工作，并在以后使用很有用</li>
<li>在无状态服务之间可靠地发送数据</li>
<li>我知道的仅有的一个不会在分区时丢失数据的是Kafka<ul>
<li>或许 SQS 也可以？</li>
</ul>
</li>
<li>队列不会提高端到端延迟<ul>
<li>总是更快地立即完成工作</li>
</ul>
</li>
<li>队列不会提高平均吞吐<ul>
<li>平均吞吐被消费者限制</li>
</ul>
</li>
<li>当消费者并发时，队列不提供总事件排序<ul>
<li>消费者几乎肯定是并发的</li>
</ul>
</li>
<li>同样，队列不保证异步使用者的事件顺序<ul>
<li>因为消费者的副作用可能无序发生</li>
<li>所以，不要依赖顺序</li>
</ul>
</li>
<li>队列不能提供最多一次或者最少一次的递送<ul>
<li>任何声称不这样做的人都试图向你推销一些东西</li>
<li>恢复一次性递送需要仔细控制副作用</li>
<li>使您的排队操作具有幂等性</li>
</ul>
</li>
<li>队列确实提高了突发吞吐量<ul>
<li>平滑负载峰值</li>
</ul>
</li>
<li>分布式队列还提高了容错（如果不丢失数据）<ul>
<li>如果不需要容错或者大缓冲，使用TCP</li>
<li>很多人使用具有六个磁盘写入和十五个网络跃点的队列，其中单个套接字write()可能已经足够</li>
</ul>
</li>
<li>当您选择了糟糕的运行时时，队列可以让您脱离绑定</li>
</ul>
<h3 id="_51">回顾</h3>
<p>我们使用数据结构存储作为外置堆：它们是分布式系统的管道磁带。 KV存储和关系数据库通常被部署为记录系统; KV存储使用独立key，不太适合关系数据，但与SQL存储相比提供了更好的可伸缩性和部分容错性，SQL存储提供了丰富的查询和强大的事务保证。分布式搜索和协调服务完善了我们构建应用程序的基本工具包。 流系统应用于数据集的连续，低延迟处理，并且往往看起来更像框架而不是数据库。 分布式队列专注于<em>消息</em>而不是<em>转换</em>。</p>
<h2 id="_52">模式语言</h2>
<ul>
<li>构建分布式系统的一般建议<ul>
<li>来之不易的经历</li>
<li>重复其他专家告诉我的内容<ul>
<li>over beers</li>
</ul>
</li>
<li>Hearsay</li>
<li>Oversimplifications</li>
<li><a href="https://en.wikipedia.org/wiki/Cargo_cult_programming">Cargo-culting</a></li>
<li>Stuff I just made up</li>
<li>YMMV</li>
</ul>
</li>
</ul>
<h3 id="_53">不要用分布式</h3>
<ul>
<li>规则1：如果不是必须，请不要使用分布式<ul>
<li>本地系统有可靠的原语。锁、线程、队列、事务。<ul>
<li>当你迁移到分布式系统时，你必须从头开始</li>
</ul>
</li>
<li>这个问题是否很小可以在一个节点上完成？<ul>
<li>我有一个很大的数据问题<ul>
<li><a href="http://www.softlayer.com/">Softlayer</a>将以每箱5000美元的价格租给一箱3TB的内存</li>
<li>Supermicro将以约115,000美元的价格出售6TB的盒子</li>
</ul>
</li>
<li>现代计算机很快<ul>
<li>我所知道的生产JVM HTTP服务已经可以支持50K请求/秒<ul>
<li>解析JSON时间，记日志到磁盘，推送到S3</li>
</ul>
</li>
<li>使用TCP的协议缓冲区：1000万/s的事件</li>
</ul>
</li>
<li>这项服务能否容忍单个节点的保证？</li>
<li>如果它破了，我们可以再起来吗？</li>
<li>手动干预可以取代分布式算法吗？</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="_54">使用已经存在的分布式系统</h3>
<ul>
<li>如果必须分布，可以将任务推送到其它软件？<ul>
<li>分布式数据库或者日志怎么样？</li>
<li>可以给亚马逊付钱让他们来做吗？</li>
<li>相反，维护费用是多少？</li>
<li>学习使用/操作该分布式系统多少钱？</li>
</ul>
</li>
</ul>
<h3 id="_55">永不故障</h3>
<ul>
<li>购买非常昂贵的硬件</li>
<li>以受控方式更改软件和硬件<ul>
<li>在临时环境上部署</li>
</ul>
</li>
<li>可以构建非常可靠的网络和机器<ul>
<li>以降低成本为代价，购买更昂贵的硬件，寻找人才</li>
<li>硬件/网络故障仍然<em>发生</em>，但足够罕见=&gt;低优先级</li>
</ul>
</li>
</ul>
<h3 id="_56">接受故障</h3>
<ul>
<li>分布式系统不仅以<em>延迟</em>为特征，但以<em>经常性，部分故障为特征</em></li>
<li>我们能接受这种失败并继续我们的生活吗？<ul>
<li>我们的SLA是什么？</li>
<li>可以手动恢复吗？</li>
<li>可以给人付钱来修复吗？</li>
<li>保险可以承担损害吗？</li>
<li>我们可以打电话给客户并道歉吗？</li>
</ul>
</li>
<li>听起来很傻，但是更加便宜<ul>
<li>我们永远也不能阻止100%的系统故障</li>
<li>有意识地选择恢复高于系统的水平</li>
<li>这就是金融公司和零售商的做法</li>
</ul>
</li>
</ul>
<h3 id="_57">备份</h3>
<ul>
<li>备份基本是顺序一致的，但是可能丢失一个操作窗口的数据<ul>
<li>当正确完成时<ul>
<li>一些备份程序没有快照状态，导致文件系统或者数据库损坏</li>
<li>破坏外键关系，丢失文件等...</li>
</ul>
</li>
<li>允许恢复到几分钟或者几天前</li>
<li>但是除了故障恢复，可以让你按时间返回<ul>
<li>从逻辑故障中恢复很有用<ul>
<li>分布式数据库正确完成其任务，但是告诉数据库删除了关键数据</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="_58">冗余</h3>
<ul>
<li>
<p>好的，所以失败不是一个选择</p>
</li>
<li>
<p>希望降低故障的可能性</p>
</li>
<li>
<p>在几个节点上进行相同的状态和相同的计算</p>
<ul>
<li>
<p>我不是 主-备 的忠实信徒</p>
<ul>
<li>
<p>备机可能有冷缓存，损坏的磁盘，旧版本等</p>
</li>
<li>
<p>备机在变为主机时往往会失败</p>
</li>
<li>
<p>尽可能主-主</p>
</li>
</ul>
</li>
<li>
<p>我也不是只有两个副本的忠实的粉丝</p>
<ul>
<li>节点故障概率太高</li>
<li>对于不重要的数据还可以</li>
<li>我一般都想要3份数据副本<ul>
<li>对于重要的数据，4或者5分副本</li>
<li>对于Paxo或者其它的多数派系统，&#8535;/7很常见</li>
<li>常见的策略：Paxos跨越5个节点，3个或者4个在本地数据中心</li>
</ul>
</li>
<li>操作可以在本地节点确认后立即完成;低延迟</li>
<li>适应单节点故障（虽然延迟会出现峰值）</li>
<li>但是在另一个DC中仍然有一个顺序一致的备份</li>
<li>所以如果你失去了整个DC，那么一切都不会丢失</li>
<li>参见Camille Fournier关于ZK部署的会谈</li>
<li>只要故障不相关，冗余就可以提高可用性<ul>
<li>失败并非不相关</li>
<li>来自同一批次的磁盘同时失败</li>
<li>当架顶式交换机断开时，同一机架节点出现故障</li>
<li>UPS断电时，相同DC节点发生故障</li>
<li>查看整个EC2 AZ故障</li>
<li>在每个节点上运行相同的错误计算将中断每个节点</li>
</ul>
</li>
<li>昂贵的查询</li>
<li>Riak list-keys</li>
<li>Cassandra doomstones<ul>
<li>级联故障</li>
</ul>
</li>
<li>Thundering-herd</li>
<li>TCP incast</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="_59">分片</h3>
<ul>
<li>这个问题很大</li>
<li>将问题分解成足够小的部分以适合节点<ul>
<li>不小：小零件=&gt;高开销</li>
<li>不太大：需要逐个从节点到节点重新平衡工作单元</li>
<li>大约10-100个工作单位/节点是理想的</li>
</ul>
</li>
<li>理想的：工作单元相同的大小<ul>
<li>注意热点</li>
<li>注意负载随时间变化</li>
</ul>
</li>
<li>了解你的界限<ul>
<li>压倒一个节点之前单个部分有多大？</li>
<li>我们如何在它节点上出现之前，如何强制执行该限制？</li>
</ul>
</li>
<li>分配分片给节点<ul>
<li>在数据库中内置</li>
<li>很好的候选，ZK，Etcd等等</li>
<li>参见Boundary's Ordasity</li>
</ul>
</li>
</ul>
<h3 id="_60">独立的域</h3>
<ul>
<li>分片是一般模式避免协调的一个特殊场景<ul>
<li>保持尽可能独立<ul>
<li>提高容错</li>
<li>提高性能</li>
<li>减少复杂性</li>
</ul>
</li>
<li>分片提高伸缩性</li>
<li>通过CRDT避免协调</li>
<li>Flake ID：<strong>mostly</strong> time-ordered identifiers, zero-coordination<ul>
<li>参考： <a href="http://yellerapp.com/posts/2015-02-09-flake-ids.html">http://yellerapp.com/posts/2015-02-09-flake-ids.html</a></li>
</ul>
</li>
<li>部分可用：用户可以继续使用系统的一些部分</li>
<li>处理队列：更多消费者减少昂贵事件的影响</li>
</ul>
</li>
</ul>
<h3 id="id">ID结构</h3>
<ul>
<li>在我们的世界中，一定需要唯一的标识<ul>
<li>在规模上，ID结构可以决定你的成败</li>
<li>考虑下面的开销<ul>
<li>扫描</li>
<li>排序</li>
<li>分片</li>
</ul>
</li>
<li>顺序ID需要协调：我们可以避免吗？<ul>
<li>Flake ID，UUID</li>
</ul>
</li>
<li>对于可分片，你的ID可以直接映射到一个分片吗？</li>
<li>SaaS应用：对象ID也可以编码客户ID</li>
<li>Twitter：推特ID可以编码用户ID</li>
</ul>
</li>
</ul>
<h3 id="_61">不变的值</h3>
<ul>
<li>从不更改的数据存储起来很简单<ul>
<li>不需要协调</li>
<li>复制和恢复开销很小</li>
<li>在磁盘上很小的重新打包代价</li>
</ul>
</li>
<li>对于Cassandra，Riak，和LSM树DB很有用<ul>
<li>或者像Kafka的日志</li>
</ul>
</li>
<li>原因很简单：要么是存在，要么不存在<ul>
<li>消除各种事务的头痛问题</li>
<li>非常容易缓存</li>
</ul>
</li>
<li>高可用和持久性，可调节的写入延迟<ul>
<li>低写入延迟：可以从最近的副本做应答</li>
<li>对于地理分布尤其有价值</li>
</ul>
</li>
<li>需要垃圾回收<ul>
<li>但有很好的方法可以做到</li>
</ul>
</li>
</ul>
<h3 id="_62">可变值</h3>
<ul>
<li>指向变值的指针</li>
<li>指针很小！仅元数据<ul>
<li>可以在小DB中存储很多的指针</li>
<li>对于协调服务或者关系DB，是很好的候选</li>
</ul>
</li>
<li>典型地，在系统中没有很多指针<ul>
<li>你的全部DB可以在用一个指针表示</li>
<li>Datomic only has ~5 identities</li>
</ul>
</li>
<li>对标识的强一致性操作可以由不可变的HA存储支持<ul>
<li>利用AP存储延迟和规模</li>
<li>利用共识系统提供的小数据集的强一致性</li>
<li>写的可用性受到标识存储的限制<ul>
<li>但是，如果你只需要顺序一致性，就可以读缓存</li>
<li>如果您只需要序列化就可以更容易</li>
</ul>
</li>
<li>参见Rich Hickey关于Datomic架构的演讲</li>
<li>参见Pat Helland在2013年关于Salesforce存储的Ricon West主题演讲</li>
</ul>
</li>
</ul>
<h3 id="_63">汇合</h3>
<ul>
<li>与顺序无关的系统更容易构造和推理</li>
<li>因此，可以避免协调</li>
<li>CRDT是汇合的，这意味着我们可以应用更新而不必等待</li>
<li>不变的值通常是汇合的：一旦存在，就固定了</li>
<li>流媒体系统也可以利用汇合：<ul>
<li>当你知道你已经看到了所有内容时，缓冲事件和计算+刷新</li>
<li>发出部分结果，以便您现在可以采取操作，例如用于监视</li>
<li>当完整数据可用时，通过加法或者最大值来合并</li>
<li>银行分类账（大部分）是汇合的：事务顺序不影响余额<ul>
<li>但当你需要执行一个最小余额时，就不再是汇合了</li>
<li>结合密封事件（例如当天结束）以恢复汇合</li>
</ul>
</li>
</ul>
</li>
<li>参考 Aiken, Widom, &amp; Hellerstein 1992, "Behavior of Database Production Rules"</li>
</ul>
<h3 id="_64">背压</h3>
<ul>
<li>
<p>交互的服务通常通过队列连接</p>
</li>
<li>
<p>服务和队列的容量是有限的</p>
</li>
<li>
<p>当下游服务无法处理负载时，您如何处理它？</p>
<ol>
<li>消耗资源并爆炸</li>
<li>摆脱负载，开始删除请求</li>
<li>拒绝请求，忽略任务，应答客户端失败</li>
<li>给客户端背压，告诉客户端放慢速度</li>
</ol>
</li>
<li>
<p>2-4允许系统追赶并恢复</p>
<ul>
<li>但是，背压减少了必须重试的工作量</li>
</ul>
</li>
<li>
<p>背压取决于生产者的选择：组成成分</p>
<ul>
<li>
<p>减载系统的客户端被锁定在减载中</p>
<ul>
<li>他们没有办法知道系统已被冲洗过</li>
</ul>
</li>
<li>
<p>背压系统的客户端可以将背压应用到他们的客户端</p>
<ul>
<li>或卸载，依赖他们选择</li>
</ul>
</li>
<li>如果你在实现一个异步系统，一定要包括反压力<ul>
<li>你的用户会感谢你</li>
</ul>
</li>
</ul>
</li>
<li>
<p>基本上：边界资源</p>
<ul>
<li>请求超时（有界时间）</li>
<li>指数退避（有界使用）</li>
<li>有界队列</li>
<li>有界并发</li>
</ul>
</li>
<li>
<p>参考：Zach Tellman, "Everything Will Flow"</p>
</li>
</ul>
<h3 id="_65">域模型服务</h3>
<ul>
<li>问题由相互作用的逻辑部分组成</li>
<li>每个逻辑部分具有不同的代码，性能和存储需求</li>
<li>单体应用程序基本上是<em>多租户</em>系统<ul>
<li>多租户很难</li>
<li>但通常可以在同一个过程中运行多个逻辑“服务”</li>
</ul>
</li>
<li>将您的系统划分为域的离散部分的逻辑服务模型</li>
<li>OO方法：每个<em>名词</em>是一种服务<ul>
<li>用户服务</li>
<li>视频服务</li>
<li>索引服务</li>
</ul>
</li>
<li>功能方法：每个<em>动词</em>是一项服务<ul>
<li>验证服务</li>
<li>搜索服务</li>
<li>调度/路由服务</li>
</ul>
</li>
<li>我所知道的大多数大型系统都使用混合方式<ul>
<li>名词服务是强制执行<em>数据类型不变量的好方法</em></li>
<li>动词服务是强制执行<em>转换不变量的好方法</em></li>
<li>所以有一个基本的用户服务，<em>由Auth服务使用</em></li>
</ul>
</li>
<li>你画线的地方......那很棘手<ul>
<li>服务带来开销：尽可能少</li>
<li>考虑工作单元</li>
<li>需要独立扩展的独立服务</li>
<li>具有严格依赖性和严格延迟预算的服务</li>
<li>使用补充资源（例如磁盘和CPU）的协同服务</li>
<li>手动：在渲染节点上运行memcache</li>
<li>较新的商店：Google Borg，Mesos，Kubernetes</li>
</ul>
</li>
<li>服务应该封装和抽象<ul>
<li>尝试建造树而不是网</li>
<li>避免让外人直接操纵服务的数据存储</li>
</ul>
</li>
<li>服务之间的协调需要特殊协议<ul>
<li>必须重新发明事务</li>
<li>尽可能去通信</li>
<li>萨加斯</li>
<li>是为单节点世界编写的：我们必须在分布式环境中聪明一点</li>
<li>事务必须是幂等的，或者一起回滚</li>
<li><a href="http://www.cs.ucsb.edu/~vaibhavarora/Typhon-Ieee-Cloud-2017.pdf">Typhon / Cerberus</a></li>
<li>多个数据存储的因果一致性协议</li>
</ul>
</li>
</ul>
<h3 id="_66">结构遵循社交空间</h3>
<ul>
<li>制作软件是一种基本的社交工具</li>
<li>自然对齐：团队或个人拥有特定服务</li>
<li>乔·弗里曼，“无结构的暴政”<ul>
<li>责任和权力应该是明确的</li>
<li>通过角色轮换人员以防止领地</li>
<li>促进信息共享</li>
<li>但不要经常旋转</li>
<li>软件的增加成本非常高</li>
</ul>
</li>
<li>随着团队的成长，其使命和思想将正式化</li>
<li>服务和他们的界限也是如此</li>
<li>逐渐积累关于与世界的服务关系的假设</li>
<li>重写以应对不断变化的外部压力</li>
<li>Tushman＆Romanelli，1985：组织演变</li>
<li>服务可以是库</li>
<li>最初，您的所有服务应该是库</li>
<li>完全可以依赖多个服务中的用户库</li>
<li>具有明确界限的库很容易被提取出来成为服务</li>
<li>社会结构管理库/服务边界</li>
<li>由于库的用户很少，或者用户协调紧密，因此更改很容易</li>
<li>但是在许多团队中，用户有不同的优先级，必须让他们信服</li>
<li>为什么用户应该做一些工作来升级到新的库版本？</li>
<li>服务<em>强制</em>通过定义的API弃用生命周期进行协调<ul>
<li>您还可以通过代码审查和工具对库强制执行此操作</li>
</ul>
</li>
<li>服务支持集中控制</li>
<li>您的性能改进会立即影响每个人</li>
<li>逐步转换为新的磁盘格式或支持数据库</li>
<li>在一个地方使用该服务</li>
<li>更难用库做这些事情</li>
<li>服务有成本</li>
<li>网络调用的故障复杂性和延迟开销</li>
<li>服务依赖的混乱</li>
<li>很难静态分析代码路径</li>
<li>您认为库API版本很难</li>
<li>额外的仪器/部署</li>
<li>服务可以使用良好的客户端库</li>
<li>该库可能是“打开套接字”或HTTP客户端<ul>
<li>利用HTTP标头！</li>
<li>接受标题版本</li>
<li>对缓存和代理的大量支持</li>
<li>Haproxy是HTTP和TCP服务的优秀路由器</li>
</ul>
</li>
<li>最终，库可能包含模拟IO<ul>
<li>服务团队负责测试服务是否提供API</li>
<li>当已知API稳定时，每个客户都可以<em>假设</em>它有效</li>
<li>无需在测试套件中进行网络呼叫</li>
<li>大幅减少测试运行时和开发环境的复杂性</li>
</ul>
</li>
</ul>
<h3 id="_67">回顾</h3>
<p>如果可能，请尝试使用单个节点而不是分布式系统。 接受一些失败是不可避免的：SLA和道歉可能具有成本效益。 为了处理灾难性故障，我们使用备份。为了提高可靠性，我们引入了冗余。 为了扩展到大的问题域，我们将问题分成片。不可变值易于存储和缓存，并且可以通过可变身份引用，允许我们在大规模上构建强大一致的系统。 随着软件的发展，不同的组件必须独立扩展，我们将库分解为不同的服务。 服务结构与团队密切配合。</p>
<h2 id="_68">生产问题</h2>
<ul>
<li>不仅仅是设计考虑</li>
<li>证明很重要，但真正的系统需要IO</li>
</ul>
<h3 id="_69">您的文化支持分布式系统</h3>
<ul>
<li>理解生产中的分布式系统需要具有多种角色的人员密切合作。<ul>
<li>部署</li>
<li>QA</li>
<li>操作</li>
</ul>
</li>
<li>共性问题<ul>
<li>开发需要关注产品</li>
<li>运行需要关注实现</li>
<li>好的沟通可以更快地诊断问题</li>
</ul>
</li>
</ul>
<h3 id="_70">测试一切</h3>
<ul>
<li>
<p>类型系统非常适合防止逻辑错误</p>
<ul>
<li>减少了测试负担</li>
</ul>
</li>
<li>
<p>然而，它们在预测或控制运行时性能方面并不是很好</p>
</li>
<li>
<p>所以，需要可靠的测试套件</p>
<ul>
<li>理想情况下，您需要一个严格不同类型的测试</li>
<li>几秒钟内运行的快速基于示例的测试</li>
<li>可以在一夜之间运行的更彻底的基于属性的测试</li>
<li>能够在进程中模拟整个集群</li>
<li>控制与模拟网络的并发交织</li>
<li>自动化的硬件故障</li>
</ul>
</li>
<li>
<p>测试分布式系统比测试本地系统要困难得多</p>
<ul>
<li>你从未听说过的大量失败模式</li>
<li>组合状态空间</li>
<li>错误只能表现为小/大/中间时间/空间/并发</li>
</ul>
</li>
</ul>
<h3 id="_71">“这很慢”</h3>
<ul>
<li>杰夫霍奇斯：你会听到的最糟糕的错误是“它很慢”</li>
<li>一直发生，很难本地化</li>
<li>由于系统是分布式的，因此必须分析多个节点<ul>
<li>为此建立的分析工具并不多</li>
<li>Sigelman等，2010：Dapper，一种大规模分布式系统跟踪
     基础设施</li>
<li>Zipkin</li>
<li>大工具投资</li>
</ul>
</li>
<li>分析工具擅长发现CPU问题<ul>
<li>但高延迟通常是IO的标志，而不是CPU</li>
<li>磁盘延迟</li>
<li>网络延迟</li>
<li>GC延迟</li>
<li>队列延迟</li>
</ul>
</li>
<li>尝试使用应用程序级指标本地化问题<ul>
<li>然后深入了解流程和操作系统性能</li>
</ul>
</li>
<li>执行相同工作的节点之间的延迟差异是一个重要信号<ul>
<li>&#8531;节点慢：可能是节点硬件，重新路由</li>
<li>3/3节点缓慢：可能是逻辑错误：查看分片大小，工作负载，查询</li>
</ul>
</li>
<li>扇出工作负载放大了尾部延迟<ul>
<li><a href="https://research.google.com/pubs/pub40801.html">Jeff Dean，2013：The Tail at Scale</a></li>
<li>考虑推测并行性</li>
</ul>
</li>
</ul>
<h3 id="_72">测量一切</h3>
<ul>
<li>生产中的缓慢（和彻头彻尾的错误）源于<em>相互作用</em>
   系统</li>
<li>为什么？因为您的全面测试套件可能验证了单一系统大多是正确的</li>
<li>所以我们需要一种方法来了解系统在生产中做了什么<ul>
<li>关于其依赖性</li>
<li>反过来，这可以推动新的测试</li>
</ul>
</li>
<li>在某种程度上，良好的监控就像持续测试<ul>
<li>但不是替代品：这些是不同的领域</li>
<li>两者均可确保您的更改正常</li>
</ul>
</li>
<li>想要高频监控<ul>
<li>生产行为可以在1毫秒的规模上进行</li>
<li>TCP incast</li>
<li>理想情况下~~ 1ms分辨率</li>
<li>在极限情况下，Ops响应时间与观察延迟呈线性关系</li>
<li>约1秒的端到端延迟</li>
<li>理想情况下，毫秒级延迟，也可能是ms分辨率</li>
<li>通常成本过高;回到1或10秒</li>
<li>有时你可以忍受60秒</li>
</ul>
</li>
<li>对于容量规划，每小时/每日季节性更有用</li>
<li>测量应与应用程序紧密耦合<ul>
<li>只衡量重要的事情</li>
<li>回应请求很重要</li>
<li>节点CPU并不重要</li>
<li>大多数系统的关键指标</li>
<li>Apdex：在延迟SLA内使用成功的应答</li>
<li>延迟分布：0,0.5,0.95,0.99,1<ul>
<li>百分位数，而不是平均数</li>
<li>顺便说一句，你不能采取百分位数的均值</li>
</ul>
</li>
<li>总吞吐量</li>
<li>队列统计</li>
<li>其他系统延迟/吞吐量的主观体验<ul>
<li>数据库可能认为它很健康，但客户可能会觉得它很慢</li>
<li>组合爆炸 —— 在深入故障时最好使用它</li>
</ul>
</li>
<li>您可能必须自己编写此测量</li>
<li>投资指标库</li>
</ul>
</li>
<li>开箱即用的监控通常无法衡量真正重要的因素：您的
     应用程序的行为<ul>
<li>但它在追踪问题原因方面非常有用</li>
<li>主机指标，如CPU，磁盘等</li>
<li>你的应用程序做了一些常见的事情（例如rails应用程序）工具，如New
    Relic，运作良好</li>
</ul>
</li>
<li>客户端的分片指标<ul>
<li>当用户具有不同的工作负载时很有用</li>
<li>可以调整阈值以适应该客户端</li>
<li>主要客户端分一些，“其余”的另一个桶</li>
</ul>
</li>
<li>超级工具：分布式跟踪（Zipkin，Dapper等）<ul>
<li>大量时间投资</li>
<li><a href="https://www.usenix.org/system/files/conference/osdi14/osdi14-paper-chow.pdf">神秘机器</a></li>
<li>从跟踪数据自动推断服务之间的因果关系</li>
<li>识别关键路径</li>
<li>在实施之前对新算法进行性能建模</li>
</ul>
</li>
</ul>
<h3 id="_73">日志</h3>
<ul>
<li>记录在大规模系统上不太有用<ul>
<li>问题可能未本地化到一个节点</li>
<li>当请求触及更多服务时，必须跟踪许多日志文件</li>
<li>投资日志收集基础设施<ul>
<li>ELK，Splunk等</li>
</ul>
</li>
<li>非结构化信息难以汇总</li>
<li>记录结构化事件</li>
</ul>
</li>
</ul>
<h3 id="_74">影子流量</h3>
<ul>
<li>负载测试仅在模拟负载与实际负载匹配时才有用</li>
<li>考虑转储生产流量<ul>
<li>太棒了：使用SIGUSR1终止一个进程，它会转储五分钟的请求加载</li>
<li>太棒了：tcpdump / tcpreplay用于请求的限制</li>
<li>太棒了：将实时流量映射到您的暂存/ QA节点</li>
</ul>
</li>
<li>见 Envoy from Lyft</li>
</ul>
<h3 id="_75">版本</h3>
<ul>
<li>据我所知，协议版本控制是一个广泛存在的问题<ul>
<li>包括所有消息的版本标记</li>
<li>包括兼容性逻辑</li>
<li>当客户的请求无法处理时通知客户</li>
<li>并对此进行检测，以便了解哪些系统必须升级</li>
</ul>
</li>
</ul>
<h3 id="_76">推广</h3>
<ul>
<li>推广通常是您如何解决问题的方法</li>
<li>花时间进行自动化，可靠的部署<ul>
<li>放大你做的其他事情</li>
<li>节点平滑循环以防止流量中断</li>
<li>这意味着您将同时运行多个版本的软件<ul>
<li>版本控制其丑陋的头部</li>
</ul>
</li>
<li>通知负载均衡器会退出</li>
<li>协调以防止级联故障</li>
</ul>
</li>
<li>仅推出一小部分负载或部分用户<ul>
<li>逐渐增加新软件的用户数量</li>
<li>当您看到错误时，可以还原或向前回滚</li>
<li>考虑在生产环境中跟踪流量并比较旧/新版本</li>
<li>确定新代码是否更快和正确的好方法</li>
</ul>
</li>
</ul>
<h3 id="_77">特性标志</h3>
<ul>
<li>我们希望在部署后逐步推出变更集</li>
<li>逐个引入功能，以了解它们对指标的影响</li>
<li>逐步将负载从一个数据库转移到另一个数据库</li>
<li>当推广出错时禁用功能</li>
<li>我们希望在某些服务降级时获得部分可用性</li>
<li>禁用代价昂贵的功能以在故障期间加速恢复</li>
<li>使用高度可用的协调服务来确定要使用的代码路径或多久一次</li>
<li>此服务应具有最小的依赖性<ul>
<li>不要使用主DB</li>
</ul>
</li>
<li>当出现问题时，您可以调整系统的行为</li>
<li>协调服务停止时，失败<em>安全</em>！</li>
</ul>
<h3 id="_78">混沌工程</h3>
<ul>
<li>打破生产中的东西</li>
<li>迫使工程师适当地<em>现在</em>处理故障，而不是稍后对事件的响应</li>
<li>识别关键路径中的意外依赖关系<ul>
<li>“当新的统计数据服务出现故障时，需要使用API。是吗？
    <em>确定</em>那是必要的吗？</li>
</ul>
</li>
<li>
<p>需要良好的仪表和警报，因此您可以衡量事件影响</p>
</li>
<li>
<p>爆炸半径有限</p>
<ul>
<li>不要每五分钟核对整个数据中心</li>
<li>但是<em>做</em>每季度尝试一次</li>
<li>不要破坏复制组中的许多节点</li>
<li>一次只打破一小部分请求/用户</li>
</ul>
</li>
</ul>
<h3 id="_79">哦不，队列</h3>
<ul>
<li>每个队列都是一个可怕的地方，可怕的错误</li>
<li>没有节点有无限制的内存。你的队列<em>必须</em>有界限</li>
<li>但有多大？没人知道</li>
<li>在生产环境中检测你的队列以找出答案</li>
<li>使用队列以平滑负载的波动</li>
<li>以延迟为代价提高吞吐量</li>
<li>如果您的负载高于容量，则没有队列可以节省您的费用<ul>
<li>当队列变满时，卸载负荷或施加背压</li>
<li>测量这个</li>
<li>当发生卸载负荷时，警铃响起</li>
<li>背压作为上游延迟可见</li>
</ul>
</li>
<li>测量队列深度<ul>
<li>高深度是您需要添加节点容量的线索</li>
<li>端到端队列延迟应小于波动时间尺度</li>
<li>提高队列大小可能很诱人，但这是一个恶性循环</li>
</ul>
</li>
<li>所有这一切都很难。我没有你的好答案<ul>
<li>问Jeff Hodges为什么这很难：看他2013年的RICON West谈话</li>
<li>见Zach Tellman —— 一切都会流动</li>
</ul>
</li>
</ul>
<h2 id="_80">回顾</h2>
<p>运行分布式系统需要开发人员，QA和运营工程师之间的合作。静态分析和包括基于示例和属性的测试的测试套件可以帮助确保程序的正确性，但了解生产行为需要全面的测量和警报。成熟的分布式系统团队经常投资工具：流量阴影，版本控制，增量部署和功能标记。最后，队列需要特别小心。</p>
<h2 id="_81">进一步阅读</h2>
<ul>
<li>
<p>Mixu has a delightful book on distributed systems with incredible detail. <a href="http://book.mixu.net/distsys/">http://book.mixu.net/distsys/</a></p>
</li>
<li>
<p>Jeff Hodges has some excellent, production-focused advice. <a href="https://www.somethingsimilar.com/2013/01/14/notes-on-distributed-systems-for-young-bloods/">https://www.somethingsimilar.com/2013/01/14/notes-on-distributed-systems-for-young-bloods/</a></p>
</li>
<li>
<p>The Fallacies of Distributed Computing is a classic text on mistaken assumptions we make designing distributed systems. <a href="http://www.rgoarchitects.com/Files/fallacies.pdf">http://www.rgoarchitects.com/Files/fallacies.pdf</a></p>
</li>
<li>
<p>Christopher Meiklejohn has a list of key papers in distributed systems. <a href="http://christophermeiklejohn.com/distributed/systems/2013/07/12/readings-in-distributed-systems.html">http://christophermeiklejohn.com/distributed/systems/2013/07/12/readings-in-distributed-systems.html</a></p>
</li>
<li>
<p>Nancy Lynch's "Distributed Algorithms" is a comprehensive overview of the field from a more theoretical perspective</p>
</li>
</ul>
<p>原文：<a href="https://github.com/iswade/distsys-class">https://github.com/iswade/distsys-class</a></p>
<p>翻译：王世德</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="页脚" >
      
        
        <a href="../F1_query/" class="md-footer__link md-footer__link--prev" aria-label="上一页: F1 Query" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              F1 Query
            </div>
          </div>
        </a>
      
      
        
        <a href="../../articles/partition/" class="md-footer__link md-footer__link--next" aria-label="下一页: 数据分区" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              数据分区
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2022 iswade
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>