
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://iswade.github.io/translate/Google_practices/review/review/">
      
      <link rel="icon" href="../../../../themes/me.svg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>代码检视开发者指导 - iswade's blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../themes/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="white" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="iswade&#39;s blog" class="md-header__button md-logo" aria-label="iswade's blog" data-md-component="logo">
      
  <img src="../../../../themes/me.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            iswade's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              代码检视开发者指导
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="iswade&#39;s blog" class="md-nav__button md-logo" aria-label="iswade's blog" data-md-component="logo">
      
  <img src="../../../../themes/me.svg" alt="logo">

    </a>
    iswade's blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        主页
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          数据库
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="数据库" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/adb_nodes/00_index/" class="md-nav__link">
        高级数据库笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../articles/buffer/buffer_details/" class="md-nav__link">
        PostgreSQL缓存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../crdb/crdb_paper_cn/" class="md-nav__link">
        CockroachDB翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../crdb/crdb_paper/" class="md-nav__link">
        CockroachDB论文
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../taurus_paper_cn/" class="md-nav__link">
        TaurusDB翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../taurus_paper/" class="md-nav__link">
        TaurusDB论文
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../articles/pebble/" class="md-nav__link">
        Pebble KV存储引擎
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../faunadb_transaction/" class="md-nav__link">
        FaunaDB分布式事务协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Aurora_design_cloud_native_database/" class="md-nav__link">
        Aurora云原生关系数据库
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../btree_vs_lsmtree/" class="md-nav__link">
        现代存储系统背后的算法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/db_nodes/00_database_systems_2018/" class="md-nav__link">
        数据库笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../F1_query/" class="md-nav__link">
        F1 Query
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          分布式系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="分布式系统" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          分布式系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../distsys/" class="md-nav__link">
        分布式系统大纲
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../articles/partition/" class="md-nav__link">
        数据分区
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../strong_consistency_models/" class="md-nav__link">
        强一致性模型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../zookeeper/" class="md-nav__link">
        Zookeeper论文翻译
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../paxos_made_live/" class="md-nav__link">
        Paxos Made Live翻译
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          编程语言
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="编程语言" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          编程语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../articles/go_concurrency/" class="md-nav__link">
        Go并发编程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../go_interface/" class="md-nav__link">
        如何使用Go接口
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          软件工程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="软件工程" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          软件工程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/pragmatic_programmer/" class="md-nav__link">
        程序员修炼之道
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/bash_turorial/" class="md-nav__link">
        bash教程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_sysadmin/" class="md-nav__link">
        linux系统管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/git/" class="md-nav__link">
        git入门教程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../to_be_manager/" class="md-nav__link">
        How to be a manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    代码检视者应该检视什么？
  </a>
  
    <nav class="md-nav" aria-label="代码检视者应该检视什么？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    选择最佳的检视人员
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    面对面检视
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    参见
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="_1">代码检视开发者指导</h1>
<h2 id="_2">介绍</h2>
<p>代码检视是一个过程，除了一段代码的作者之外的其他人检视该代码。</p>
<p>在 Google，我们使用代码检视来维护代码和产品的质量。此文档是 Google 代码检视流程和政策的规范说明。</p>
<p>此文档是我们的代码检视流程的概述。本指南还有另外两个更大的文档：</p>
<ul>
<li><a href="#如何做代码检视">如何做代码检视</a>：代码检视员的详细指南。</li>
<li><a href="#变更作者指导">变更作者指南</a>：需要检视的变更列表的开发人员详细指南。</li>
</ul>
<h2 id="_3">代码检视者应该检视什么？</h2>
<p>代码检视应该查看：</p>
<ul>
<li><strong>设计</strong>：代码是否经过精心设计并适合您的系统？</li>
<li><strong>功能</strong>：代码的行为是否与作者可能的意图相同？代码对用户的行为方式是否正常？</li>
<li><strong>复杂</strong>：代码可以变得更简单吗？是否有其他开发人员能够在将来遇到此代码时轻松理解并使用此代码？</li>
<li><strong>测试</strong>：代码是否具有正确且设计良好的自动化测试？</li>
<li><strong>命名</strong>：开发人员是否为变量，类，方法等选择了明确的名称？</li>
<li><strong>注释</strong>：注释是否清晰有用？</li>
<li><strong>风格</strong>：代码是否遵循我们的风格指南？</li>
<li><strong>文档</strong>：开发人员是否也更新了相关文档？</li>
</ul>
<p>有关更多信息，请参见如何执行代码检视。</p>
<h3 id="_4">选择最佳的检视人员</h3>
<p>一般而言，您希望找到能够在合理的时间段内回复您的检视的最佳检视者。</p>
<p>最好的检视者是能够为您编写的代码提供最彻底和最正确的检视的人。这通常意味着代码的所有者，他们可能是也可能不是文件所有者中的人。有时这意味着要求不同的人检视变更列表的不同部分。</p>
<p>如果您找到了理想的检视人但是他们不可用，那么，对于你的变更，您应该至少抄送他们。</p>
<h2 id="_5">面对面检视</h2>
<p>如果您的一段代码已经进行了结对编程，并且结对的人有资格进行很好的代码检视，那么该代码将被视为已检视。</p>
<p>您还可以进行面对面的代码检视，其中检视者提出问题，然后代码变更的开发人员仅在与之交谈时发言。</p>
<h2 id="_6">参见</h2>
<ul>
<li><a href="#如何做代码检视">如何做代码检视</a>：给代码检视人员的更详细的指导。</li>
<li><a href="#变更作者指导">变更作者指导</a>：需要检视的变更列表的开发人员详细指南。</li>
</ul>
<h1 id="_7">如何做代码检视</h1>
<p>基于长期经验，本节中的页面包含有关进行代码检视的最佳方式的建议。它们共同代表了一个完整的文档，分为许多单独的部分。你不必全部阅读它们，但是很多人发现阅读全部内容对自己和他们的团队都非常有帮助。</p>
<h2 id="_8">代码检视标准</h2>
<p>代码检视的主要目的是确保 Google 代码库的整体代码运行状况随着时间的推移而得到改善。代码检视的所有工具和流程都是为此而设计的。</p>
<p>为了实现这一目标，必须平衡一系列的权衡。</p>
<p>首先，开发人员必须能够在他们的任务上取得进展。如果您从未提交过代码库的改进，那么代码库永远不会改进。此外，如果检视人员难以进行任何更改，那么开发人员不会在未来进行改进。</p>
<p>另一方面，检视者有责任确保每个 CL 具有这样的质量，即随着时间的推移，其代码库的整体代码健康度不会降低。这可能很棘手，因为代码库通常会随着时间的推移而降低代码健康度，特别是当团队受到严重的时间限制并且他们觉得必须采取捷径才能实现目标时。</p>
<p>此外，检视者对他们正在检视的代码拥有所有权和责任。他们希望确保代码库保持一致，可维护以及“<a href="##在代码检视中应该检视什么">代码检视者应该检视什么</a>”中提到的所有其他内容。</p>
<p>因此，我们将以下规则作为我们在代码检视中期望的标准：</p>
<p><strong>一般来说，一旦 CL 处于一种状态，即使 CL 不完美，它肯定会提高正在处理的系统的整体代码健康度，那么它应该倾向于批准 CL。</strong></p>
<p>这是所有代码检视指南中的高级原则。</p>
<p>当然，这有一些限制。例如，如果 CL 添加了检视者在其系统中不需要的功能，那么即使代码设计良好，检视者也肯定会拒绝批准。</p>
<p>这里的一个关键点是没有“完美”代码这样的东西 —— 只有更好的代码。检视人不应要求作者在批准之前对每一小块 CL 进行润色。相反，与他们所建议的变化的重要性相比，检视人员应该平衡进展的必要性。检视人应该寻求的是持续改进，而不是追求完美。作为一个整体，提高系统的可维护性，可读性和可理解性的 CL 不应该延迟数天或数周，因为它不是“完美的”。</p>
<p>检视者应该随时留下评论，表达可能更好的东西，但如果它不是很重要，请在其前面加上“Nit:”之类的内容，让作者知道这只是他们可以选择忽略的一点点。</p>
<p>注意：本文档中没有任何内容证明在 CL 中检查肯定会恶化系统的整体代码健康度。你唯一能做的就是紧急情况。</p>
<h3 id="_9">指导</h3>
<p>代码检视可以具有向开发人员教授关于语言，框架或通用软件设计原则的新内容的重要功能。留下评论可以帮助开发人员学习新东西，这总是很好的。共享知识是随着时间的推移改善系统代码健康度的一部分。请记住，如果您的评论纯粹是教育性的，但对于满足本文档中描述的标准并不重要，请在其前面添加“Nit:”或以其他方式表明作者不必在此 CL 中解决它。</p>
<h3 id="_10">原则</h3>
<ul>
<li>技术事实和数据否决了意见和个人偏好。</li>
<li>在风格问题上，风格指南是绝对权威。任何不在风格指南中的纯粹风格点（空白等）都是个人偏好的问题。风格应该与那里的风格一致。如果没有以前的样式，请接受作者的。</li>
<li>软件设计方面几乎从来不是纯粹的风格问题，也不仅仅是个人偏好。它们基于基本原则，应该权衡这些原则，而不仅仅是个人意见。有时候会有一些有效的选择。如果作者可以证明（通过数据或基于可靠的工程原理）几种方法同样有效，那么审阅者应该接受作者的偏好。否则，选择取决于软件设计的标准原则。</li>
<li>如果没有其他规则适用，则检视者者可以要求作者与当前代码库中的内容保持一致，只要这不会恶化系统的整体代码健康度。</li>
</ul>
<h3 id="_11">解决冲突</h3>
<p>在代码检视的任何冲突中，第一步应该始终是开发人员和审阅者根据本文档的内容以及“CL作者指导”和“检视者指导”中的其他文档达成共识。</p>
<p>当达成共识变得特别困难时，它可以帮助在审阅者和作者之间进行面对面的会议或VC，而不仅仅是尝试通过代码检视评论来解决冲突。（但是，如果您这样做，请确保在对CL的评论中记录讨论结果，以供将来的读者使用。）</p>
<p>如果这不能解决问题，解决问题的最常用方法是升级。通常，升级路径是更广泛的团队讨论，有TL权衡，要求维护人员对代码做出决定，或要求Eng经理提供帮助。<strong>不要让CL坐在那里因为作者和检视人不能达成协议</strong>。</p>
<h2 id="_12">在代码检视中应该注意什么</h2>
<p>注意：在考虑这些要点时，请务必考虑<a href="##代码检视标准">“代码检视标准”</a>。</p>
<h3 id="_13">设计</h3>
<p>在检视中要涵盖的最重要的事情是CL的整体设计。CL中各种代码的交互是否有意义？此更改是属于您的代码库还是属于库？它是否与您系统的其他部分很好地集成？现在是添加此功能的好时机吗？</p>
<h3 id="_14">功能</h3>
<p>这个 CL 是否符合开发人员的意图？开发人员对此代码的用户有什么好处？ “用户”通常都是最终用户（当他们受到更改影响时）和开发人员（将来必须“使用”此代码）。</p>
<p>大多数情况下，我们希望开发人员能够很好地测试 CL，以便在他们进行代码检视时能够正常工作。但是，作为检视者，您仍然应该考虑边缘情况，寻找并发问题，尝试像用户一样思考，并确保没有您通过阅读代码看到的错误。</p>
<p>您可以根据需要验证CL  —— 检视者检查CL的行为时最重要的时间是面向用户的影响，例如 <strong>UI 更改</strong>。当您只是阅读代码时，很难理解某些更改会如何影响用户。对于这样的更改，您可以让开发人员为您提供功能演示，如果在 CL 中打补丁太不方便并自行尝试。</p>
<p>另一个在代码检视期间考虑功能特别重要的时候，如果 CL 中存在某种<strong>并行编程</strong>，理论上可能导致死锁或竞争条件。通过运行代码很难检测到这些类型的问题，并且通常需要某人（开发人员和审阅者）仔细思考它们以确保不会引入问题。（请注意，这也是不使用竞争条件或死锁的并发模型的一个很好的理由 —— 它可以使代码检视或理解代码变得非常复杂。）</p>
<h3 id="_15">复杂性</h3>
<p>CL 是不是比它应该做的更复杂？在 CL 的每个级别检查这一点是否过于复杂？功能太复杂了吗？类太复杂了吗？“太复杂”通常意味着“<strong>代码阅读者无法快速理解</strong>。”它也可能意味着“<strong>开发人员在尝试调用或修改此代码时可能会引入错误</strong>。”</p>
<p>特定类型的复杂性是<strong>过度工程</strong>，其中开发人员使代码更加通用，或者添加系统当前不需要的功能。检视人应特别警惕过度工程。鼓励开发人员解决他们现在需要解决的问题，而不是开发人员推测可能需要在未来解决的问题。未来的问题应该在它到达后解决，你可以在物理世界中看到它的实际形状和要求。</p>
<h3 id="_16">测试</h3>
<p>对于变更进行适当变更的单元，集成或端到端测试。通常，除非 CL 处理紧急情况，否则应在与生产代码相同的 CL 中添加测试。</p>
<p>确保 CL 中的测试正确，合理且有用。 测试不会自己测试，我们很少为测试编写测试 —— 人类必须确保测试有效。</p>
<p>当代码被破坏时，测试是否真的会失败？如果代码在他们下面发生变化，他们会开始产生误报吗？ 每个测试都会做出简单而有用的断言吗？不同测试方法之间的测试是否适当分开？</p>
<p>请记住，测试也是必须维护的代码。不要仅仅因为它们不是主要的二进制文件的一部分而接受测试中的复杂性。</p>
<h3 id="_17">命名</h3>
<p>开发人员是否为所有内容选择了好名字？一个好名字足够长，可以完全传达项目的内容或作用，而不会太长，以至于难以阅读。</p>
<h3 id="_18">注释</h3>
<p>开发人员是否用可理解的英语撰写了清晰的注释？所有注释都是必要的吗？通常，当注释<strong>解释为什么</strong>存在某些代码时，注释很有用，并且不应该解释某些代码正在做什么。 如果代码不够清楚，无法解释自己，那么代码应该变得更简单。 有一些例外（正则表达式和复杂算法通常会从解释他们正在做的事情的评论中获益很多），但大多数注释都是针对代码本身不可能包含的信息，例如决策背后的推理。</p>
<p>查看此 CL 之前的注释也很有帮助。也许有一个 TODO 现在可以删除，一个注释建议不要进行这种改变，等等。</p>
<p>请注意，注释与类，模块或函数的文档不同，它们应该代表一段代码的目的，如何使用它，以及它在使用时的行为方式。</p>
<h3 id="_19">风格</h3>
<p>我们为 Google 提供所有主要语言的风格指南，甚至包括大多数次要语言。 确保CL遵循适当的样式指南。</p>
<p>如果你想改进样式指南中没有的一些样式点，请在评论前加上“Nit:”，让开发人员知道你认为这会改善代码，但不是强制性的。 不要仅根据个人风格偏好阻止提交 CL。</p>
<p>CL 的作者不应包括与其他更改相结合的主要样式更改。它使得很难看到 CL 中的更改，使合并和回滚更复杂，并导致其他问题。例如，如果作者想要重新格式化整个文件，让他们只将重新格式化为一个 CL，然后再发送另一个 CL 及其功能更改。</p>
<h3 id="_20">文档</h3>
<p>如果 CL 更改了用户构建，测试，交互或发布代码的方式，请检查它是否还更新了相关文档，包括README，g3doc页面和任何生成的参考文档。如果 CL 删除或弃用代码，请考虑是否也应删除文档。如果缺少文档，请询问。</p>
<h3 id="_21">每一行</h3>
<p>查看您已分配检视的每行代码。有些东西，比如数据文件，生成的代码或大型数据结构，你有时可以扫描，但不扫描人类编写的类，函数或代码块，并假设它内部的内容是没有问题的。显然，某些代码需要比其他代码更仔细的检视 —— 这是你必须做出的判断 —— 但你至少应该确定你理解所有代码正在做什么。</p>
<p>如果您阅读代码太难了，这会减慢检视速度，那么您应该让开发人员知道并等待他们在您尝试检视之前澄清它。在谷歌，我们聘请了优秀的软件工程师，你就是其中之一。如果您无法理解代码，那么很可能其他开发人员也不会。因此，当您要求开发人员澄清此代码时，您也会帮助未来的开发人员理解这些代码。</p>
<p>如果您了解代码但是您觉得没有资格进行某些部分的检视，请确保 CL 上有一个合格的检视人，特别是对于安全性，并发性，可访问性，国际化等复杂问题。</p>
<h3 id="_22">上下文</h3>
<p>在广泛的上下文背景下查看 CL 通常很有帮助。通常，代码检视工具只会显示围绕要更改的部分的几行代码。有时您必须查看整个文件以确保更改确实有意义。例如，您可能只看到添加了四个新行，但是当您查看整个文件时，您会看到这四行是在50行方法的中，现在确实需要分解为更小的方法。</p>
<p>在整个系统的上下文中考虑 CL 也很有用。 这个 CL 是否改善了系统的代码健康度，还是使整个系统更复杂，测试更少等等？ 不接受降低系统代码运行状况的 CL。 大多数系统通过许多小的变化而变得复杂，因此在新变化中防止甚至很小的复杂性也很重要。</p>
<h3 id="_23">好的事情</h3>
<p>如果你在CL中看到一些不错的方面，请告诉开发人员，特别是当他们以一种很好的方式解决你的一条评论时。代码检视通常只关注错误，但它们也应该为良好实践提供鼓励和欣赏。在指导方面，有时甚至更有价值的是告诉开发人员他们做得对，而不是告诉他们他们做错了什么。</p>
<h3 id="_24">总结</h3>
<p>在进行代码检视时，您应该确保：</p>
<ul>
<li>
<p>代码设计精良。</p>
</li>
<li>
<p>该功能对代码的用户有利。</p>
</li>
<li>
<p>任何 UI 更改都应该是明智的，并且看起来很好。</p>
</li>
<li>
<p>任何并行编程都是安全的。</p>
</li>
<li>
<p>代码并不比它需要的更复杂。</p>
</li>
<li>
<p>开发人员没有实现他们将来可能需要的东西，但现在还不知道他们需要的东西。</p>
</li>
<li>
<p>代码有适当的单元测试。</p>
</li>
<li>
<p>测试精心设计。</p>
</li>
<li>
<p>开发人员使用了清晰的名称。</p>
</li>
<li>
<p>注释是清楚和有用的，并且大多解释为什么而不是是什么。</p>
</li>
<li>
<p>代码已适当文档化（通常在g3doc中）。</p>
</li>
<li>
<p>代码符合我们的风格指南。</p>
</li>
</ul>
<p>确保查看您被要求查看的<strong>每一行</strong>代码，查看<strong>上下文</strong>，确保您在<strong>提升代码健康度</strong>，并赞扬开发人员做的好的方面。</p>
<h2 id="_25">在代码检视中查看变更</h2>
<h3 id="_26">总结</h3>
<p>既然您已经知道要查找什么，那么管理分布在多个文件中的检视的最有效方法是什么？</p>
<ol>
<li>变更是否有意义？它有很好的描述吗？</li>
<li>首先看一下变更中最重要的部分。它整体设计得很好吗？</li>
<li>以适当的顺序查看 CL 的其余部分。</li>
</ol>
<h3 id="_27">第一步：查看变更的大体内容</h3>
<p>查看 CL 描述以及 CL 的一般用途。这种变化是否有意义？首先，如果不应该发生这种变化，请立即回复，说明为什么不应该进行变更。当您拒绝这样的更改时，向开发人员建议他们应该做什么也是一个好主意。</p>
<p>例如，您可能会说“看起来您已经做了一些好的工作，谢谢！但是，我们实际上是朝着删除您在这里修改的 FooWidget 系统的方向，所以我们不想现在对它进行任何新的修改。相反，你重构我们的新 BarWidget 类怎么样？”</p>
<p>请注意，审稿人不仅拒绝当前的 CL 并提供替代建议，而且他们也礼貌地做了。这种礼貌很重要，因为我们希望表明，即使我们不同意，我们也会相互尊重。</p>
<p>如果您有多个不想做的更改的 CL，您应该考虑重新进行审视开发团队的开发过程或外部贡献者的发布过程，以便在编写 CL 之前有更多的沟通。最好在他们完成大量工作之前告诉别人“不”，这些工作现在必须被抛弃或彻底重写。</p>
<h3 id="_28">第二步：检查变更的主要部分</h3>
<p>查找作为此 CL “主要”部分的文件。通常，有一个文件具有最大数量的逻辑更改，它是 CL 的主要部分。先看看这些主要部分。这有助于为 CL 的所有较小部分提供上下文，并且通常可以加速执行代码检视。如果 CL 太大而无法确定哪些部分是主要部分，请向开发人员询问您应该首先查看的内容，或者要求他们将 CL 拆分为多个 CL。</p>
<p>如果您发现 CL 的这一部分存在一些主要的设计问题，即使您没有时间立即查看 CL 的其余部分，也应立即发送这些意见。事实上，检视 CL 的其余部分可能是浪费时间，因为如果设计问题足够严重，那么正在检视的许多其他代码将会消失，无论如何都无关紧要。</p>
<p>立即发送这些主要设计的评论非常重要有两个主要原因：</p>
<p>开发人员经常邮件发送 CL，然后在等待审核时立即开始基于该 CL 的新工作。如果您正在审核的CL 中存在重大设计问题，那么他们也将不得不重新使用他们以后的 CL。你想在他们在有问题的设计之上做了太多额外的工作之前抓住它们。</p>
<p>主要的设计变更需要更长的时间才能完成。开发人员几乎都有截止日期；为了在这些截止日期前完成，并且在代码库仍然能保证代码质量，开发人员需要尽快重新开始 CL 的主要工作。</p>
<h3 id="_29">第三步：以适当的顺序查看变更的其余部分</h3>
<p>一旦你确认整个 CL 没有重大的设计问题，试着找出一个逻辑序列来查看文件，同时确保你不会错过查看任何文件。通常在查看主要文件之后，最简单的方法是按照代码检视工具向您提供的顺序浏览每个文件。有时在阅读主代码之前先阅读测试也很有帮助，因为这样你就可以了解做些什么。</p>
<h2 id="_30">代码检视的速度</h2>
<h3 id="_31">为什么代码评论要快？</h3>
<p><strong>在谷歌，我们优化了开发团队可以共同生产产品的速度</strong>，而不是优化单个开发人员编写代码的速度。个人发展的速度很重要，它并不像整个团队的速度那么重要。</p>
<p>当代码检视很慢时，会发生以下几件事：</p>
<ul>
<li><strong>整个团队的速度降低了</strong>。是的，没有快速回复检视的个人完成了其他工作。但是，每个 CL 等待审核和重新审核时，团队其他成员的新功能和错误修复会延迟数天，数周或数月。</li>
<li><strong>开发人员开始抗议代码检视流程</strong>。如果检视者每隔几天只响应一次，但每次都要求对 CL 进行重大更改，那么开发人员可能会感到沮丧和困难。通常，这表达为对检视者的“严格”程度的抱怨。如果检视者请求相同的实质性更改（确实可以改善代码运行状况的更改），但每次开发人员进行更新时响应都很快，则投诉往往会消失。<strong>大多数关于代码检视过程的抱怨实际上是通过加快流程来解决的。</strong></li>
<li><strong>代码健康度可能会受到影响。</strong>当检视缓慢时，允许开发人员提交不尽如人意的CL的压力越来越大。慢速检视还会阻止代码清理，重构以及对现有CL的进一步改进。</li>
</ul>
<h3 id="_32">代码评审应该有多快？</h3>
<p>如果您没在处理重点任务，那么您应该在代码请求提交不久后进行代码检视。</p>
<p><strong>一个工作日是响应代码检视请求所需的最长时间</strong>（即第二天早上的第一件事）。</p>
<p>遵循这些指导意味着典型的 CL 应该在一天内进行多轮审查（如果需要）。</p>
<h3 id="_33">速度与中断</h3>
<p>有一次考虑个人速度胜过团队速度。<strong>如果您正处于重点任务的中间，例如编写代码，请不要打断自己进行代码检视。</strong>研究表明，开发人员在被打断后可能需要很长时间才能恢复顺畅的开发流程。因此，编写代码时打断自己实际上比让另一位开发人员等待代码检视代价更高。</p>
<p>相反，在回复检视请求之前，等待工作中断点。这可能是当你的当前编码任务完成，午餐后，从会议返回，从微型厨房回来等等。</p>
<h3 id="_34">快速回复</h3>
<p>当我们谈论代码检视的速度时，我们关注的是响应时间，而不 是CL 需要多长时间才能完成整个检视并提交。理想情况下，整个过程也应该是快速的，但<strong>对于快速到来的个人响应更加重要，比整个过程快速。</strong></p>
<p>即使有时需要很长时间才能完成整个审核流程，但在整个过程中获得审核者的快速响应可以显着减轻开发人员对“慢速”代码审核感到的挫败感。</p>
<p>如果您太忙而无法对CL进行全面审核，您仍然可以发送快速回复，让开发人员知道您什么时候开始，建议其他能够更快回复的审核人员，或者提供一些初步的广泛评论。 （注意：这并不意味着你应该中断编码，甚至发送这样的响应 —— 在工作中的合理断点发送响应。）</p>
<p>重要的是，审核人员要花足够的时间进行审核，确信他们的“LGTM”意味着“此代码符合我们的标准”。但是，理想情况下，个人反应应该很快。</p>
<p>跨时区评论{#tz}
在处理时区差异时，尝试在他们还在办公室时回复作者。如果他们已经回家了，那么请确保在第二天回到办公室之前完成审核。</p>
<p>LGTM评论{＃lgtm-with-comments}
为了加快代码审查，在某些情况下，审阅者应该给予LGTM / Approval，即使他们也在CL上留下未解决的评论。这可以在以下任何一种情</p>
<p>审稿人确信开发人员将适当地处理所有审阅者的剩余评论。
其余的更改很小，不必由开发人员完成。
如果不清楚的话，审核人应该指定他们想要哪些选项。</p>
<p>当开发人员和审阅者处于不同的时区时，LGTM With Comments尤其值得考虑，否则开发人员将等待一整天才能获得“LGTM，Approval”。</p>
<p>大型CL {#large}
如果有人向您发送了如此大的代码审查，您不确定何时可以有时间查看它，那么您的典型响应应该是要求开发人员将CL拆分为几个彼此构建的较小的CL而不是一个必须一次审查的巨大的CL。这通常是可能的，对审阅者非常有帮助，即使它需要开发人员的额外工作。</p>
<p>如果CL无法分解为较小的CL，并且您没有时间快速查看整个内容，那么至少要对CL的整体设计写一些评论并将其发送回开发人员以进行改进。作为审阅者，您的目标之一应该是始终取消阻止开发人员或使他们能够快速采取某种进一步的操作，而不会牺牲代码运行状况。</p>
<p>代码审查随着时间的推移而改进{#time}
如果您遵循这些准则，并且您对代码审查非常严格，那么您应该会发现整个代码审核流程会随着时间的推移而变得越来越快。开发人员可以了解健康代码所需的内容，并向您发送从一开始就很棒的CL，这需要越来越少的审核时间。审阅者学会快速响应，而不是在审核过程中添加不必要的延迟。但是，不要在代码审查标准或质量方面妥协，以实现速度的想象性改进 - 从长远来看，它实际上不会使任何事情发生得更快。</p>
<p>紧急情况
还有一些紧急情况，CL必须非常迅速地通过整个审查过程，并且质量准则将放宽。但是，请看什么是紧急情况？对于描述</p>
<h1 id="_35">变更作者指导</h1>
<p>my: </p>
<p>code health</p>
<p>像对待一个孩子一样对待代码</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2021 iswade
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>